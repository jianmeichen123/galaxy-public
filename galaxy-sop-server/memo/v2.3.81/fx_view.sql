use fx_db;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_dept_meeting_project_all` AS select `d`.`id` AS `dept_id`,`d`.`name` AS `dept_name`,`b`.`id` AS `project_id`,`a`.`meeting_type` AS `meeting_type` from (((`sop_meeting_record` `a` left join `sop_project` `b` on((`a`.`project_id` = `b`.`id`))) left join `platform_user` `c` on((`b`.`create_uid` = `c`.`id`))) left join `t_department` `d` on((`c`.`department_id` = `d`.`id`))) group by `d`.`id`,`a`.`meeting_type`,`b`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_dept_meeting_project_f` AS select `d`.`id` AS `dept_id`,`d`.`name` AS `dept_name`,`b`.`id` AS `project_id`,`a`.`meeting_type` AS `meeting_type` from (((`sop_meeting_record` `a` left join `sop_project` `b` on((`a`.`project_id` = `b`.`id`))) left join `platform_user` `c` on((`b`.`create_uid` = `c`.`id`))) left join `t_department` `d` on((`c`.`department_id` = `d`.`id`))) where (`a`.`meeting_result` = 'meetingResult:3') group by `d`.`id`,`a`.`meeting_type`,`b`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_dept_meeting_project_p` AS select `d`.`id` AS `dept_id`,`d`.`name` AS `dept_name`,`b`.`id` AS `project_id`,`a`.`meeting_type` AS `meeting_type` from (((`sop_meeting_record` `a` left join `sop_project` `b` on((`a`.`project_id` = `b`.`id`))) left join `platform_user` `c` on((`b`.`create_uid` = `c`.`id`))) left join `t_department` `d` on((`c`.`department_id` = `d`.`id`))) where (`a`.`meeting_result` = 'meetingResult:1') group by `d`.`id`,`a`.`meeting_type`,`b`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_dept_meeting_project_union` AS select `a`.`dept_id` AS `dept_id`,`a`.`dept_name` AS `dept_name`,`a`.`meeting_type` AS `meeting_type`,count(0) AS `project_num`,0 AS `project_num_p`,0 AS `project_num_f` from `v_dept_meeting_project_all` `a` group by `a`.`dept_id`,`a`.`meeting_type` union all select `a`.`dept_id` AS `dept_id`,`a`.`dept_name` AS `dept_name`,`a`.`meeting_type` AS `meeting_type`,0 AS `project_num`,count(0) AS `project_num_p`,0 AS `project_num_f` from `v_dept_meeting_project_all` `a` group by `a`.`dept_id`,`a`.`meeting_type` union all select `a`.`dept_id` AS `dept_id`,`a`.`dept_name` AS `dept_name`,`a`.`meeting_type` AS `meeting_type`,0 AS `project_num`,0 AS `project_num_p`,count(0) AS `project_num_f` from `v_dept_meeting_project_f` `a` group by `a`.`dept_id`,`a`.`meeting_type`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_dept_meeting_rate` AS select `a`.`dept_id` AS `dept_id`,`a`.`dept_name` AS `dept_name`,`a`.`meeting_type` AS `meeting_type`,sum(`a`.`project_num`) AS `project_num`,sum(`a`.`project_num_p`) AS `project_num_p`,sum(`a`.`project_num_f`) AS `project_num_f`,sum(((`a`.`project_num` - `a`.`project_num_p`) - `a`.`project_num_f`)) AS `project_num_s`,(case when (sum(`a`.`project_num`) > 0) then round((sum(`a`.`project_num_p`) / sum(`a`.`project_num`)),4) else 0 end) AS `p_rate` from `v_dept_meeting_project_union` `a` group by `a`.`dept_id`,`a`.`meeting_type`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_meeting_progress_status` AS select `a`.`project_id` AS `project_id`,`a`.`meeting_type` AS `meeting_type`,count(0) AS `meeting_count`,date_format(from_unixtime((`b`.`created_time` / 1000)),'%Y-%m-%d %H:%i:%s') AS `create_time`,max(`a`.`meeting_date`) AS `meeting_date`,(case when (min(right(`a`.`meeting_result`,1)) = 1) then 'meetingResult:1' when (max(right(`a`.`meeting_result`,1)) = 3) then 'meetingResult:3' else 'meetingResult:2' end) AS `meeting_result_code`,(case when (min(right(`a`.`meeting_result`,1)) = 1) then '通过' when (max(right(`a`.`meeting_result`,1)) = 3) then '否决' else '待定' end) AS `meeting_result`,(case when ((case when (min(right(`a`.`meeting_result`,1)) = 1) then 'meetingResult:1' when (max(right(`a`.`meeting_result`,1)) = 3) then 'meetingResult:3' else 'meetingResult:2' end) = 'meetingResult:1') then round((1 / count(0)),6) else 0 end) AS `prate` from ((`sop_meeting_record` `a` left join `sop_meeting_scheduling` `b` on(((`a`.`project_id` = `b`.`project_id`) and (`a`.`meeting_type` = `b`.`meeting_type`)))) left join `sop_project` `c` on((`a`.`project_id` = `c`.`id`))) group by `a`.`project_id`,`a`.`meeting_type`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_project_interview_count` AS select `a`.`id` AS `project_id`,count(`b`.`id`) AS `jcft_count` from (`sop_project` `a` left join `sop_interview_record` `b` on((`a`.`id` = `b`.`project_id`))) group by `a`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_project_meeting_and_task` AS select `pro`.`id` AS `project_id`,`va`.`jcft_count` AS `jcft_count`,`vb`.`meeting_count` AS `np_meeting_count`,`vb`.`prate` AS `np_prate`,`dd`.`create_time` AS `ceops_create_time`,`dd`.`meeting_count` AS `ceops_meeting_count`,`dd`.`meeting_result` AS `ceops_meeting_result`,`dd`.`meeting_date` AS `ceops_meeting_date`,`dd`.`prate` AS `ceops_prate`,`ee`.`create_time` AS `lxh_created_time`,`ee`.`meeting_count` AS `lxh_meeting_count`,`ee`.`meeting_result` AS `lxh_meeting_result`,`ee`.`meeting_date` AS `lxh_meeting_date`,`ee`.`prate` AS `lxh_prate`,`ff`.`create_time` AS `tjh_created_time`,`ff`.`meeting_count` AS `tjh_meeting_count`,`ff`.`meeting_result` AS `tjh_meeting_result`,`ff`.`meeting_date` AS `tjh_meeting_date`,`ff`.`prate` AS `tjh_prate`,(case when (`c`.`file_status` = 'fileStatus:1') then '待上传' when ((`c`.`file_status` = 'fileStatus:2') and (`e`.`task_status` <> 'taskStatus:3')) then '处理中' when ((`c`.`file_status` = 'fileStatus:3') or (`e`.`task_status` = 'taskStatus:3')) then '已签署' end) AS `tzyxs_status`,(case when ((`pro`.`stock_transfer` = 0) or (`pro`.`project_type` = 'projectType:2')) then (case when (`f`.`file_status` = 'fileStatus:1') then '待上传' when ((`f`.`file_status` = 'fileStatus:3') or (`h`.`task_status` = 'taskStatus:3')) then '已签署' else '处理中' end) when (`pro`.`stock_transfer` = 1) then (case when ((`f`.`file_status` = 'fileStatus:1') or (`i`.`file_status` = 'fileStatus:1')) then '待上传' when (((`f`.`file_status` = 'fileStatus:2') or (`i`.`file_status` = 'fileStatus:2')) and (`f`.`file_status` <> 'fileStatus:1') and (`i`.`file_status` <> 'fileStatus:1')) then '处理中' when ((`f`.`file_status` = 'fileStatus:3') and (`i`.`file_status` = 'fileStatus:2')) then '已签署' end) end) AS `tzxy_status`,(case when ((`k`.`file_status` = 'fileStatus:1') or (`m`.`file_status` = 'fileStatus:1')) then '待上传' when ((`q`.`task_status` <> 'taskStatus:3') or (`p`.`task_status` <> 'taskStatus:3')) then '处理中' when ((`q`.`task_status` = 'taskStatus:3') and (`p`.`task_status` = 'taskStatus:3')) then '已完成' end) AS `gqjg_status`,(case when (`pro`.`project_type` = 'projectType:1') then round((((((case when (`v`.`task_status` = 'taskStatus:3') then 1 else 0 end) + (case when (`w`.`task_status` = 'taskStatus:3') then 1 else 0 end)) + (case when (`x`.`task_status` = 'taskStatus:3') then 1 else 0 end)) + (case when (`y`.`task_status` = 'taskStatus:3') then 1 else 0 end)) / 4),6) else round((((case when (`v`.`task_status` = 'taskStatus:3') then 1 else 0 end) + (case when (`y`.`task_status` = 'taskStatus:3') then 1 else 0 end)) / 2),6) end) AS `jzdc_completed_rate` from ((((((((((((((((((((((((((((((`sop_project` `pro` left join `sop_meeting_scheduling` `a` on((`pro`.`id` = `a`.`project_id`))) left join `dict` `b` on((`a`.`status` = `b`.`dict_code`))) left join `v_project_interview_count` `va` on((`pro`.`id` = `va`.`project_id`))) left join `v_meeting_progress_status` `vb` on(((`pro`.`id` = `vb`.`project_id`) and (`vb`.`meeting_type` = 'meetingType:1')))) left join `v_meeting_progress_status` `dd` on(((`pro`.`id` = `dd`.`project_id`) and (`dd`.`meeting_type` = 'meetingType:2')))) left join `v_meeting_progress_status` `ee` on(((`pro`.`id` = `ee`.`project_id`) and (`ee`.`meeting_type` = 'meetingType:3')))) left join `v_meeting_progress_status` `ff` on(((`pro`.`id` = `ff`.`project_id`) and (`ff`.`meeting_type` = 'meetingType:4')))) left join `sop_file` `c` on(((`pro`.`id` = `c`.`project_id`) and (`c`.`file_worktype` = 'fileWorktype:5')))) left join `dict` `d` on((`c`.`file_status` = `d`.`dict_code`))) left join `sop_task` `e` on(((`pro`.`id` = `e`.`project_id`) and (`e`.`task_flag` = 1)))) left join `sop_file` `f` on(((`pro`.`id` = `f`.`project_id`) and (`f`.`file_worktype` = 'fileWorktype:6')))) left join `dict` `g` on((`f`.`file_status` = `g`.`dict_code`))) left join `sop_task` `h` on(((`pro`.`id` = `h`.`project_id`) and (`h`.`task_flag` = 6)))) left join `sop_file` `i` on(((`pro`.`id` = `i`.`project_id`) and (`i`.`file_worktype` = 'fileWorktype:7')))) left join `dict` `j` on((`i`.`file_status` = `j`.`dict_code`))) left join `sop_file` `k` on(((`pro`.`id` = `k`.`project_id`) and (`k`.`file_worktype` = 'fileWorktype:8')))) left join `dict` `l` on((`k`.`file_status` = `l`.`dict_code`))) left join `sop_file` `m` on(((`pro`.`id` = `m`.`project_id`) and (`m`.`file_worktype` = 'fileWorktype:9')))) left join `dict` `n` on((`m`.`file_status` = `n`.`dict_code`))) left join `sop_task` `o` on(((`pro`.`id` = `o`.`project_id`) and (`o`.`task_flag` = 7)))) left join `sop_task` `p` on(((`pro`.`id` = `p`.`project_id`) and (`p`.`task_flag` = 8)))) left join `sop_task` `q` on(((`pro`.`id` = `q`.`project_id`) and (`q`.`task_flag` = 9)))) left join `sop_file` `r` on(((`pro`.`id` = `r`.`project_id`) and (`r`.`file_worktype` = 'fileWorktype:1')))) left join `sop_file` `s` on(((`pro`.`id` = `s`.`project_id`) and (`s`.`file_worktype` = 'fileWorktype:2')))) left join `sop_file` `t` on(((`pro`.`id` = `t`.`project_id`) and (`t`.`file_worktype` = 'fileWorktype:3')))) left join `sop_file` `u` on(((`pro`.`id` = `u`.`project_id`) and (`u`.`file_worktype` = 'fileWorktype:4')))) left join `sop_task` `v` on(((`pro`.`id` = `v`.`project_id`) and (`v`.`task_flag` = 2)))) left join `sop_task` `w` on(((`pro`.`id` = `w`.`project_id`) and (`w`.`task_flag` = 3)))) left join `sop_task` `x` on(((`pro`.`id` = `x`.`project_id`) and (`x`.`task_flag` = 4)))) left join `sop_task` `y` on(((`pro`.`id` = `y`.`project_id`) and (`y`.`task_flag` = 5)))) group by `pro`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_project_meeting_and_task_ceops_bak` AS select `pro`.`id` AS `project_id`,date_format(from_unixtime((`a`.`created_time` / 1000)),'%Y-%m-%d %H:%i:%s') AS `create_time`,`a`.`meeting_count` AS `meeting_count`,`b`.`name` AS `meeting_result`,`a`.`meeting_date` AS `meeting_date`,(case when ((`a`.`status` = 'meetingResult:1') and (`a`.`meeting_count` > 0)) then round((1 / `a`.`meeting_count`),6) else 0 end) AS `prate` from ((`sop_project` `pro` left join `sop_meeting_scheduling` `a` on((`pro`.`id` = `a`.`project_id`))) left join `dict` `b` on((`a`.`status` = `b`.`dict_code`))) where (`a`.`meeting_type` = 'meetingType:2') group by `pro`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_project_meeting_and_task_lxh_bak` AS select `pro`.`id` AS `project_id`,date_format(from_unixtime((`a`.`created_time` / 1000)),'%Y-%m-%d %H:%i:%s') AS `create_time`,`a`.`meeting_count` AS `meeting_count`,`b`.`name` AS `meeting_result`,`a`.`meeting_date` AS `meeting_date`,(case when ((`a`.`status` = 'meetingResult:1') and (`a`.`meeting_count` > 0)) then round((1 / `a`.`meeting_count`),6) else 0 end) AS `prate` from ((`sop_project` `pro` left join `sop_meeting_scheduling` `a` on((`pro`.`id` = `a`.`project_id`))) left join `dict` `b` on((`a`.`status` = `b`.`dict_code`))) where (`a`.`meeting_type` = 'meetingType:3') group by `pro`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_project_meeting_and_task_tjh_bak` AS select `pro`.`id` AS `project_id`,date_format(from_unixtime((`a`.`created_time` / 1000)),'%Y-%m-%d %H:%i:%s') AS `create_time`,`a`.`meeting_count` AS `meeting_count`,`b`.`name` AS `meeting_result`,`a`.`meeting_date` AS `meeting_date`,(case when ((`a`.`status` = 'meetingResult:1') and (`a`.`meeting_count` > 0)) then round((1 / `a`.`meeting_count`),6) else 0 end) AS `prate` from ((`sop_project` `pro` left join `sop_meeting_scheduling` `a` on((`pro`.`id` = `a`.`project_id`))) left join `dict` `b` on((`a`.`status` = `b`.`dict_code`))) where (`a`.`meeting_type` = 'meetingType:4') group by `pro`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_project_np_meeting_count` AS select `a`.`id` AS `project_id`,count(`b`.`id`) AS `np_meeting_count`,(case when (count(`b`.`id`) > 0) then round(((case when (`b`.`meeting_result` = 'meetingResult:1') then 1 else 0 end) / count(`b`.`id`)),6) else 0 end) AS `np_prate` from (`sop_project` `a` left join `sop_meeting_record` `b` on(((`a`.`id` = `b`.`project_id`) and (`b`.`meeting_type` = 'meetingType:1')))) group by `a`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_project_progress_duration` AS select `a`.`id` AS `project_id`,(case when isnull(`b`.`meeting_date`) then 0 else ((unix_timestamp(min(`b`.`meeting_date`)) * 1000) - `a`.`created_time`) end) AS `jcft_ms`,(case when isnull(`c`.`created_time`) then 0 else (`c`.`created_time` - (unix_timestamp(min(`b`.`meeting_date`)) * 1000)) end) AS `np_ms`,(case when isnull(`d`.`created_time`) then 0 else (`d`.`created_time` - `c`.`created_time`) end) AS `ceops_ms`,(case when isnull(`e`.`created_time`) then 0 else (`e`.`created_time` - `d`.`created_time`) end) AS `lxh_ms`,(case when isnull(`f`.`created_time`) then 0 else (`f`.`created_time` - `e`.`created_time`) end) AS `tzyxs_ms`,(case when isnull(`g`.`created_time`) then 0 else (`g`.`created_time` - `f`.`created_time`) end) AS `jzdcbg_ms`,(case when isnull(`k`.`created_time`) then 0 else (`k`.`created_time` - `g`.`created_time`) end) AS `tjh_ms`,(case when isnull(`l`.`created_time`) then 0 else (`l`.`created_time` - `k`.`created_time`) end) AS `tzxy_ms`,(case when (`a`.`project_progress` = 'projectProgress:1') then ((unix_timestamp() * 1000) - `a`.`created_time`) else (case when isnull(`b`.`meeting_date`) then 0 else ((unix_timestamp(min(`b`.`meeting_date`)) * 1000) - `a`.`created_time`) end) end) AS `jcft_t_ms`,(case when (`a`.`project_progress` = 'projectProgress:2') then ((unix_timestamp() * 1000) - (unix_timestamp(min(`b`.`meeting_date`)) * 1000)) else (case when isnull(`c`.`created_time`) then 0 else (`c`.`created_time` - (unix_timestamp(min(`b`.`meeting_date`)) * 1000)) end) end) AS `np_t_ms`,(case when (`a`.`project_progress` = 'projectProgress:3') then ((unix_timestamp() * 1000) - `c`.`created_time`) else (case when isnull(`d`.`created_time`) then 0 else (`d`.`created_time` - `c`.`created_time`) end) end) AS `ceops_t_ms`,(case when (`a`.`project_progress` = 'projectProgress:4') then ((unix_timestamp() * 1000) - `d`.`created_time`) else (case when isnull(`e`.`created_time`) then 0 else (`e`.`created_time` - `d`.`created_time`) end) end) AS `lxh_t_ms`,(case when (`a`.`project_progress` = 'projectProgress:5') then ((unix_timestamp() * 1000) - `e`.`created_time`) else (case when isnull(`f`.`created_time`) then 0 else (`f`.`created_time` - `e`.`created_time`) end) end) AS `tzyxs_t_ms`,(case when (`a`.`project_progress` = 'projectProgress:6') then ((unix_timestamp() * 1000) - `f`.`created_time`) else (case when isnull(`g`.`created_time`) then 0 else (`g`.`created_time` - `f`.`created_time`) end) end) AS `jzdcbg_t_ms`,(case when (`a`.`project_progress` = 'projectProgress:7') then ((unix_timestamp() * 1000) - `g`.`created_time`) else (case when isnull(`k`.`created_time`) then 0 else (`k`.`created_time` - `g`.`created_time`) end) end) AS `tjh_t_ms`,(case when (`a`.`project_progress` = 'projectProgress:8') then ((unix_timestamp() * 1000) - `k`.`created_time`) else (case when isnull(`l`.`created_time`) then 0 else (`l`.`created_time` - `k`.`created_time`) end) end) AS `tzxy_t_ms`,(case when ((`l`.`task_status` = 'taskStatus:3') and (`m`.`task_status` = 'taskStatus:3')) then (case when (`l`.`updated_time` >= `m`.`updated_time`) then (`l`.`updated_time` - `l`.`created_time`) else (`m`.`updated_time` - `l`.`created_time`) end) else ((unix_timestamp() * 1000) - `l`.`created_time`) end) AS `gqjg_ms` from (((((((((`sop_project` `a` left join `sop_meeting_record` `b` on(((`a`.`id` = `b`.`project_id`) and (`b`.`meeting_type` = 'meetingType:1')))) left join `sop_meeting_scheduling` `c` on(((`a`.`id` = `c`.`project_id`) and (`c`.`meeting_type` = 'meetingType:2')))) left join `sop_meeting_scheduling` `d` on(((`a`.`id` = `d`.`project_id`) and (`d`.`meeting_type` = 'meetingType:3')))) left join `sop_task` `e` on(((`a`.`id` = `e`.`project_id`) and (`e`.`task_flag` = 1)))) left join `sop_task` `f` on(((`a`.`id` = `f`.`project_id`) and (`f`.`task_flag` = 5)))) left join `sop_meeting_scheduling` `g` on(((`a`.`id` = `g`.`project_id`) and (`g`.`meeting_type` = 'meetingType:4')))) left join `sop_task` `k` on(((`a`.`id` = `k`.`project_id`) and (`k`.`task_flag` = 6)))) left join `sop_task` `l` on(((`a`.`id` = `l`.`project_id`) and (`l`.`task_flag` = 9)))) left join `sop_task` `m` on(((`a`.`id` = `m`.`project_id`) and (`m`.`task_flag` = 8)))) group by `a`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_user_meeting_project_all` AS select `c`.`id` AS `user_id`,`b`.`id` AS `project_id`,`a`.`meeting_type` AS `meeting_type` from ((`sop_meeting_record` `a` left join `sop_project` `b` on((`a`.`project_id` = `b`.`id`))) left join `platform_user` `c` on((`b`.`create_uid` = `c`.`id`))) group by `c`.`id`,`a`.`meeting_type`,`b`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_user_meeting_project_f` AS select `c`.`id` AS `user_id`,`b`.`id` AS `project_id`,`a`.`meeting_type` AS `meeting_type` from ((`sop_meeting_record` `a` left join `sop_project` `b` on((`a`.`project_id` = `b`.`id`))) left join `platform_user` `c` on((`b`.`create_uid` = `c`.`id`))) where (`a`.`meeting_result` = 'meetingResult:3') group by `c`.`id`,`a`.`meeting_type`,`b`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_user_meeting_project_p` AS select `c`.`id` AS `user_id`,`b`.`id` AS `project_id`,`a`.`meeting_type` AS `meeting_type` from ((`sop_meeting_record` `a` left join `sop_project` `b` on((`a`.`project_id` = `b`.`id`))) left join `platform_user` `c` on((`b`.`create_uid` = `c`.`id`))) where (`a`.`meeting_result` = 'meetingResult:1') group by `c`.`id`,`a`.`meeting_type`,`b`.`id`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_user_meeting_project_union` AS select `a`.`user_id` AS `user_id`,`a`.`meeting_type` AS `meeting_type`,count(0) AS `project_num`,0 AS `project_num_p`,0 AS `project_num_f` from `v_user_meeting_project_all` `a` group by `a`.`user_id`,`a`.`meeting_type` union all select `a`.`user_id` AS `user_id`,`a`.`meeting_type` AS `meeting_type`,0 AS `project_num`,count(0) AS `project_num_p`,0 AS `project_num_f` from `v_user_meeting_project_p` `a` group by `a`.`user_id`,`a`.`meeting_type` union all select `a`.`user_id` AS `user_id`,`a`.`meeting_type` AS `meeting_type`,0 AS `project_num`,0 AS `project_num_p`,count(0) AS `project_num_f` from `v_user_meeting_project_f` `a` group by `a`.`user_id`,`a`.`meeting_type`;

CREATE ALGORITHM=UNDEFINED DEFINER=`fxuser`@`10.%.%.%` SQL SECURITY DEFINER VIEW `v_user_meeting_rate` AS select `a`.`user_id` AS `user_id`,`a`.`meeting_type` AS `meeting_type`,`b`.`department_id` AS `dept_id`,sum(`a`.`project_num`) AS `project_num`,sum(`a`.`project_num_p`) AS `project_num_p`,sum(`a`.`project_num_f`) AS `project_num_f`,sum(((`a`.`project_num` - `a`.`project_num_p`) - `a`.`project_num_f`)) AS `project_num_s`,(case when (sum(`a`.`project_num`) > 0) then round((sum(`a`.`project_num_p`) / sum(`a`.`project_num`)),4) else 0 end) AS `prate` from (`v_user_meeting_project_union` `a` left join `platform_user` `b` on((`a`.`user_id` = `b`.`id`))) group by `a`.`user_id`,`a`.`meeting_type`;
