<!-- 时间插件 -->
<link href="/sop/bootstrap/bootstrap-datepicker/datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
<link href="/sop/bootstrap/bootstrap-datepicker/css/bootstrap-datepicker3.css" type="text/css" rel="stylesheet"/>
<script type="text/javascript" src="/sop/bootstrap/bootstrap-datepicker/datetimepicker/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/sop/bootstrap/bootstrap-datepicker/datetimepicker/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="/sop/bootstrap/bootstrap-datepicker/js/bootstrap-datepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="/sop/bootstrap/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js" charset="UTF-8"></script>
<script src="/sop/bootstrap/bootstrap-datepicker/js/datepicker-init.js"></script>
<div  class="qualificationstc">
	<div class="title_bj" id="pop-title">添加分拨计划</div>
    <div class="qualifications_all">
		<form id = "detail-form" >
    	<ul>
			<input name="id" type="text" style="display:none">
			<input name="index" type="text" style="display:none">
			<input name="code"  type="text" style="display:none">
			<input name="projectId" type="text" style="display:none">
			<input name="titleId"  type="text" style="display:none">
			<input name="subCode" type="hidden"  value="">
   			<li>
   			       <dl class="fmdl">
		                <dt>分拨名称 ：</dt>
		                <dd>
		                	<div>
		                    	<input class="edittxt" id="field1" name="field1" type="text" value="" maxLength="20" valType="OTHER" regString="^.{1,20}$" msg="<font color=red>*</font>只能输入20个字符"/>
		                    </div> 
		                </dd>
		            </dl>
   			       <dl class="fmdl">
		                <dt>计划注资时间 ：</dt>
		                <dd>
		                	<div>
		                    	<input readonly id="field2" name="field2" class="datepicker fl txt time"  type="text" data-date-format="yyyy-mm-dd"/>
		                    </div> 
		                </dd>
		            </dl>
	                 <dl class="fmdl">
		                <dt>计划注资金额 ：</dt>
		                <dd>
		                	
		                	<div class='moeny_all'>
		                    	<input class=" txt " id="field3" name="field3" type="text" value="" required data-rule-verify_94="true"  data-msg-verify_94="<font color=red>*</font>支持9位长度的四位小数" />
		                    	<span id="editMoney" class="bj_hui"></span>
		                    	<span class='money'>万元</span>
		                    </div> 
	                        <div class="gray">剩余金额<span id="formatRemainMoney"></span>万元</div> 
		                </dd>
		            </dl>
		             <dl class="fmdl">
		                <dt>付款条件 ：</dt>
		                <dd>
		                	<div>
		                    	<input class="edittxt" id="field4" name="field4" type="text" value="" maxLength="20" valType="OTHER" regString="^.{1,20}$" msg="<font color=red>*</font>只能输入20个字符"/>
		                    </div> 
		                </dd>
		            </dl>
   			</li>
   			
   		</ul>
		</form>
    	<div class="team_tit">实际注资<span class="team_ico team_ico_add appr_part_add" data-code="study-experience" href="/sop/html/operation_appr_actual.html"></span></div>
		<div class="team_p" id="appr_part">

		</div>

    </div>
    
    <div class="button_affrim">
        <a href="javascript:;"  class="register_all_affrim fl" id="save_appr_part" >确定</a>
        <a href="javascript:;"  class="register_all_input fr"  id="part_cancle" data-close="close">取消</a>
    </div>
</div>

<script>
$(function(){
	 $("#detail-form").validate({});
	$.validator.setDefaults({
		errorElement:'span'
	});
})
/**
 * 运营报告-分期拨款-实际拨款弹窗
 */
$("div").delegate(".appr_part_add","click",function(event){
	event.stopPropagation();
  	var $self = $(this);
	var _url = $self.attr("href");
	var _name= $self.attr("data-name");
	$.getHtml({
		url:_url,//模版请求地址
		data:"",//传递参数
		okback:function(){
           
		}//模版反回成功执行
	});
	return false;
});
remainMoney();
function remainMoney(){   //计算剩余金额
	var params={};
	params.projectId = projectInfo.id;
	params.titleId = "3004";
	sendPostRequestByJsonObj(
				Constants.sopEndpointURL+'/galaxy/infoProject/getTotalAppr' , 
				params,
				function(data){
					if(data.result.status == "OK"){
						if(typeof(data.userData) == "object"){
							if(data.userData.totalMoney || data.userData.remainMoney){
								var remainMoney=data.userData.remainMoney;
								$("#formatRemainMoney").text(remainMoney == null ? 0 : remainMoney);
								$(".moeny_all input").on("input",function(){
									var val=$(this).val();
									var remainMoneyNew=remainMoney-val;
									$("#formatRemainMoney").text(remainMoneyNew < 0 ? 0 : remainMoneyNew);
								})
							}
						}
					}
				});
}
</script>
<style>
#field3-error{position:absolute;left:100px;width:100px;;}
</style>

