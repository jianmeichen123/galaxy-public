<link href="/sop/bootstrap/bootstrap-datepicker/css/bootstrap-datepicker3.css" type="text/css" rel="stylesheet"/>
<script type="text/javascript" src="/sop/bootstrap/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
<script type="text/javascript" src="/sop/bootstrap/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js"></script>
<script type="text/javascript" src="/sop/bootstrap/bootstrap-datepicker/js/datepicker-init.js"></script>
<script src="/sop/bootstrap/js/bootstrap.min.js"></script>
<script src="/sop/bootstrap/js/bootstrap-select.js"></script>
<link href="/sop/bootstrap/css/bootstrap-select.css" type="text/css" rel="stylesheet"/>
<div class="qualificationstc errortc finace_history_tc task-abandon-content" style="overflow:hidden;">
	<div class="title_bj abandon-title" >新建通知</div>
	<form action="" id="detail-form">
	
    <div  class="qualifications_all task-todeal assign_project system-content">
    <input type="hidden" id="messageId">
        <ul>
        	<li class='task-todeal-textarea system_tips_content'>
        		<div class='task-reason'><em>*</em>通知内容：</div>
        		<textarea  placeholder='请输入通知内容'  class="role_toolTip_area system_textarea" name="messageContent" maxlength="30" required data-msg-required="<font color=red>*</font>移交原因不能为空" data-rule-verify_100="true" data-msg-verify_100="<font color=red>*</font>移交原因不能为空" ></textarea>
        	</li>
        	<li class='task-todeal-textarea'>
        		<div class='task-reason'><em>*</em>目标平台：</div>
        		<div class='checkbox-div'>
	        		<label class="highlighCheckbox">
	        			<input type="checkbox" name="osType" value="Web">
	        		</label>
	        		<span>Web</span>
        		</div>
        		<div class='checkbox-div'>
	        		<label class="highlighCheckbox ">
	        			<input type="checkbox" name="osType" value="ios">
	        		</label>
	        		<span>ios</span>
        		</div>
        		<div class='checkbox-div'>
	        		<label class="highlighCheckbox ">
	        			<input type="checkbox" name="osType" value="Android">
	        		</label>
	        		<span>Android</span>
        		</div>
        		
        	</li>
            <li class='task-todeal-textarea'>
        		<div class='task-reason'><em>*</em>推送时间：</div>
        		<div class='system_radio_second' >
        			<label class="radio_cont radio_checked" data-name="">
					<input type="radio" name="isNowSend " value="0" class="radioclass">
						立即
					</label>
        		</div>
        		<div class='system_radio_second'>
        			<label class="radio_cont system_radio_second" data-name="setTime">
					<input type="radio" name="isNowSend" value="1" class="radioclass ">
						定时
					</label>
					<input  class='datatimePicture setTime' readonly='readonly' type='text' name="sendTime"/>
        		</div>
        	</li>   
        	<li>
        		<div class='task-reason'>系统升级时间：<input class='datatimePicture' readonly='readonly' type='text' name="upgradeTime"/><span class='system_tips' title="系统升级通知需要选择系统升级时间"></span></div>
        	</li>
        	<li class='noticeLi'>
        		<div class='task-reason noticeStatus'><em>*</em>通知状态：
	        		<select id="slpk" name='tipsStatus' class='selectpicker'>
	        			<!-- <option>请选择</option>
	        			<option>未发送</option>
	        			<option>已发送</option>
	        			<option>已关闭</option> -->
	        		</select>
        		</div>
        	</li>
        </ul>
      	
    
  		<div class="button_affrim tast-btn">
	        <a href="javascript:;"  class="system_send">发送</a>
   		 </div>

</div>
</form>
</div>
</div>
<style>
span.error{
	display:block;
	margin-left:75px;
}
</style>
<script>
$(function(){
		$('select[name="tipsStatus"]').change(function(){
			
		})
		
		
		selectMessageStatus(platformUrl.searchDictionaryChildrenItems+"messageStatus", "messageStatus",0);
		function selectMessageStatus(url, name, mark,selectIndex){
				sendGetRequest(url,null, function(data){
					var options = [];
					/* if(mark == 1){
						options.push('<option value="">全部</option>');
					} */
					$.each(data.entityList, function(i, value){
						if(selectIndex && i == selectIndex){
							options.push('<option index="'+i+'" selected="selected" value="'+value.code+'">'+value.name+'</option>');
						}else{
							options.push('<option index="'+i+'" value="'+value.code+'">'+value.name+'</option>');
						}
					});
					$("#slpk").html(options) 
				});
			}
		 	$('#slpk').selectpicker('refresh');  
		
	
	$('.qualificationstc').css('max-height','600px');
	$('.highlighCheckbox').click(function(event){
		if($(this).hasClass('highlighCheckbox_checked')){
			$(this).removeClass('highlighCheckbox_checked')
		}else{
			$(this).addClass('highlighCheckbox_checked')
		}
		event.preventDefault(); 
		
	})
	
	$('.noticeStatus .btn-default .filter-option').html('已发送')
	$('#slpk').attr('disabled',true)
	$('.radio_cont').click(function(){
		$('.radio_cont').removeClass('radio_checked');
		$(this).addClass('radio_checked');
		var name = $(this).attr('data-name');
		if(name=="setTime"){
			$('.system_radio_second .setTime').show();
			$('.noticeStatus .btn-default .filter-option').html('请选择');
			$('#slpk').attr('disabled',false)
		}else{
			$('.system_radio_second .setTime').hide();
			$('.noticeStatus .btn-default .filter-option').html('已发送')
			$('#slpk').attr('disabled',true)
		}
		
		
	})
	
	$('.system_radio_second input[name="sendTime"]').datepicker({//定时
	    format: 'yyyy-mm-dd',
	    language: "zh-CN",
	    autoclose: true,
	    todayHighlight: false,
	    defaultDate : Date,
	    today: "Today",
	    todayBtn:'linked',
	    leftArrow: '<i class="fa fa-long-arrow-left"></i>',
	    rightArrow: '<i class="fa fa-long-arrow-right"></i>',
	    forceParse:false,
	    currentText: 'Now',
	    minDate:new Date(),
	    /* startDate:new Date */
	})
	$('.task-reason input[name="upgradeTime"]').datepicker({//系统升级
	    format: 'yyyy-mm-dd',
	    language: "zh-CN",
	    autoclose: true,
	    todayHighlight: false,
	    defaultDate : Date,
	    today: "Today",
	    todayBtn:'linked',
	    leftArrow: '<i class="fa fa-long-arrow-left"></i>',
	    rightArrow: '<i class="fa fa-long-arrow-right"></i>',
	    forceParse:false,
	    currentText: 'Now',
	    minDate:new Date(),
	    startDate:new Date
	})
	
	/* 刚加载页面的时候就要开始判断 */
	var textArealen = $('.system_textarea').val().length;
	var checkboxLen = $('.highlighCheckbox_checked').length;
	var radioLen = $('.radio_checked').length;
	var updateTime = $('input[name="formationUpdate"]').val()
	if(textArealen==0||checkboxLen==0||updateTime==''){
		$('.system_send').addClass('system_disabled')
	}else{
		$('.system_send').removeClass('system_disabled')
	}
	
	/* 点击时候的判断 */
	$('.system-content').click(function(event){
		/* 必填项判断 */
		var textArealen = $('.system_textarea').val().length;
		var checkboxLen = $('.highlighCheckbox_checked').length;
		var radioLen = $('.radio_checked').length;
		//var updateTime = $('input[name="upgradeTime"]').val()
		if(textArealen==0||checkboxLen==0){
			$('.system_send').addClass('system_disabled')
		}else{
			$('.system_send').removeClass('system_disabled')
		}
		
		event.preventDefault(); 
	})
	
	$('.system_send ').click(function() {
			if ($(this).hasClass('system_disabled')) {
				return false
			} else {
				var data = {
				};
				var id=$("#messageId").val();
				if(null==id||""==id){
					var url = platformUrl.addMessage;
					data.id=null;
				}else{
					var url = platformUrl.updateMessage;
					data.id=id;
				}
				data.messageContent=$("textarea[name=messageContent]").val();
				data.upgradeTime=Date.parse($("input[name=upgradeTime]").val());
				data.isNowSend=$('.radio_checked').find("input:first-child").val();
				if($("input[name=sendTime]").val()==""){
					data.sendTime=Date.parse(new Date());
				}else{
					data.sendTime=Date.parse($("input[name=sendTime]").val());
				}
				var osTypeval="";
				$(".highlighCheckbox_checked").each(function (i) {
				    osTypeval=osTypeval+$(this).find("input:first-child").val()+"/"
				})
				if(""!=osTypeval){
					osTypeval=osTypeval.substring(0,osTypeval.length-1);
				}
				data.sendStatus=$("#slpk").val();
				data.osType=osTypeval;
				sendPostRequestByJsonObj(url, data, function(data) {
					var result = data.result.status;
					if (result == "ERROR") { //OK, ERROR
						layer.msg(data.result.message);
						return;
					} else {
						layer.msg("保存成功", {
							time : 500
						});
						$("#popbg").remove();
						$("#powindow").remove();
						$.locksCreenOpen();
						$('#noticeTable').bootstrapTable('refresh');
					}
				});
			}
		})

		
		
		
		
		
	})
</script>
