<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.galaxyinternet.model.project.Project" >
  <resultMap id="BaseResultMap" type="com.galaxyinternet.model.project.Project" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="project_name" property="projectName" jdbcType="VARCHAR" />
    <result column="project_code" property="projectCode" jdbcType="VARCHAR" />
    <result column="project_type" property="projectType" jdbcType="VARCHAR" />
    <result column="stock_transfer" property="stockTransfer" jdbcType="INTEGER" />
    <result column="project_careerline" property="projectCareerline" jdbcType="VARCHAR" />
    <result column="project_departId" property="projectDepartid" jdbcType="BIGINT" />    
    <result column="industry_own" property="industryOwn" jdbcType="BIGINT" />    
    <result column="project_valuations" property="projectValuations" jdbcType="DECIMAL" />    
    <result column="final_valuations" property="finalValuations" jdbcType="DECIMAL" />
    <result column="finance_status" property="financeStatus" jdbcType="VARCHAR" />    
    <result column="project_contribution" property="projectContribution" jdbcType="DECIMAL" />    
    <result column="final_contribution" property="finalContribution" jdbcType="DECIMAL" />    
    <result column="currency_unit" property="currencyUnit" jdbcType="INTEGER" />
    <result column="project_share_ratio" property="projectShareRatio" jdbcType="DECIMAL" />    
    <result column="final_share_ratio" property="finalShareRatio" jdbcType="DECIMAL" /> 
    <result column="service_charge" property="serviceCharge" jdbcType="DECIMAL" />    
    <result column="project_company" property="projectCompany" jdbcType="VARCHAR" />    
    <result column="formation_date" property="formationDate" jdbcType="BIGINT" />    
    <result column="project_company_code" property="projectCompanyCode" jdbcType="VARCHAR" />   
    <result column="company_legal" property="companyLegal" jdbcType="VARCHAR" />    
    <result column="create_uid" property="createUid" jdbcType="BIGINT" />
    <result column="create_uname" property="createUname" jdbcType="VARCHAR" />
    <result column="create_uposition" property="createUposition" jdbcType="VARCHAR" />
    <result column="project_progress" property="projectProgress" jdbcType="VARCHAR" />    
    <result column="project_status" property="projectStatus" jdbcType="VARCHAR" />    
    <result column="updated_time" property="updatedTime" jdbcType="BIGINT" />
    <result column="created_time" property="createdTime" jdbcType="BIGINT" />    
    <result column="project_describe" property="projectDescribe" jdbcType="LONGVARCHAR" />
    <result column="project_describe_financing" property="projectDescribeFinancing" jdbcType="LONGVARCHAR" />
    <result column="project_business_model" property="projectBusinessModel" jdbcType="LONGVARCHAR" />
    <result column="company_location" property="companyLocation" jdbcType="LONGVARCHAR" />
    <result column="user_portrait" property="userPortrait" jdbcType="LONGVARCHAR" />
    <result column="prospect_analysis" property="prospectAnalysis" jdbcType="LONGVARCHAR" />
    <result column="next_financing_source" property="nextFinancingSource" jdbcType="LONGVARCHAR" />
    <result column="industry_analysis" property="industryAnalysis" jdbcType="LONGVARCHAR" />
    <result column="operational_data" property="operationalData" jdbcType="LONGVARCHAR" />
    <result column="count" property="count" jdbcType="BIGINT" />
    <result column="idea_id" property="ideaId" jdbcType="BIGINT" />
    <result column="completed" property="completed" />
    <result column="type_completed" property="type_completed" />
    <result column="fa_flag" property="faFlag" jdbcType="VARCHAR" />
    <result column="fa_name" property="faName" jdbcType="VARCHAR"/>
    <result column="grean_channel" property="greanChannel" jdbcType="VARCHAR"/>
    <result column="remark" property="remark" jdbcType="LONGVARCHAR"/>
    <result column="health_state" property="healthState" jdbcType="VARCHAR"/>
    <result column="ctime" property="ctime" jdbcType="VARCHAR"/>
    <result column="grant_money" property="grantMoney" jdbcType="DECIMAL"/>
    <result column="project_time" property="projectTime" jdbcType="BIGINT"/>
    <result column="progress_history" property="progressHistory" jdbcType="VARCHAR"/>
    <result column="business_type_code" property="businessTypeCode" jdbcType="VARCHAR"/>
    <result column="finance_mode" property="financeMode" jdbcType="VARCHAR"/>
    <result column="is_delete" property="isdelete" jdbcType="BIGINT"/>
    <result column="delete_reason" property="deleteReason" jdbcType="VARCHAR"/>
     
    </resultMap>
  <sql id="Base_Column_List" >
    id, project_name, project_code, project_type, stock_transfer, project_careerline, project_departId,industry_own, 
    project_valuations,industry_own, final_valuations, project_contribution, final_contribution, currency_unit, project_share_ratio, final_share_ratio,service_charge, formation_date, project_company_code, company_legal, create_uid, 
    create_uname, create_uposition, project_progress, project_status, updated_time, created_time,
    project_describe,project_describe_financing, project_business_model, company_location, user_portrait, prospect_analysis, next_financing_source,
    industry_analysis,operational_data, idea_id,grean_channel,remark,project_time,finance_mode,progress_history,business_type_code,is_delete,delete_reason
    (SELECT r.content_describe1
	FROM information_result r 
	WHERE r.project_id = sop_project.id AND r.title_id = 1814 AND r.is_valid = 0) AS  project_company,
	(SELECT r.content_choose
	FROM information_title t
	INNER JOIN information_result r ON t.id = r.title_id 
	WHERE r.project_id = sop_project.id AND t.code = 'NO1_1_7' AND r.is_valid = 0) AS finance_status,
	(
	SELECT 
		r.content_choose 
	FROM information_result r 
	WHERE r.project_id = sop_project.id AND r.title_id = 1120 AND r.is_valid = 0
	) AS fa_flag,
    (
    SELECT 
		(CASE r.content_choose 
		WHEN 2256 THEN r1.content_describe1
		WHEN 2257 THEN r2.content_describe1	
		WHEN 2258 THEN r3.content_describe1
		WHEN 2259 THEN r4.content_describe1
		WHEN 2260 THEN r5.content_describe1	
		WHEN 2261 THEN r6.content_describe1	
		ELSE NULL
		END) 
	FROM information_result r
	LEFT JOIN information_result r1 ON r1.project_id = r.project_id AND r1.title_id = 1121 AND r1.is_valid = 0
	LEFT JOIN information_result r2 ON r2.project_id = r.project_id AND r2.title_id = 1122 AND r2.is_valid = 0
	LEFT JOIN information_result r3 ON r3.project_id = r.project_id AND r3.title_id = 1123 AND r3.is_valid = 0
	LEFT JOIN information_result r4 ON r4.project_id = r.project_id AND r4.title_id = 1124 AND r4.is_valid = 0
	LEFT JOIN information_result r5 ON r5.project_id = r.project_id AND r5.title_id = 1125 AND r5.is_valid = 0
	LEFT JOIN information_result r6 ON r6.project_id = r.project_id AND r6.title_id = 1126 AND r6.is_valid = 0
	WHERE r.project_id = sop_project.id AND r.title_id = 1120 AND r.is_valid = 0
	) AS fa_name
  </sql>
    <sql id="Base_Where_Clause">
		<where>
			<trim prefixOverrides="and">
			  <if test="id != null"> and id =#{id}</if>
			  <!-- 过滤项目 -->
				<if test="idFilter != null">
					AND id !=  #{idFilter,jdbcType=BIGINT}
				</if>
				
			   <if test="createUid != null" > and create_uid = #{createUid,jdbcType=BIGINT} </if>
			    <if test="createtUids != null">
					AND create_uid IN
					<foreach collection="createtUids" index="item" item="item" open="("
						separator="," close=")">
						#{item}
					</foreach>
			  </if>
			    <if test="projectProgress != null" > and project_progress = #{projectProgress,jdbcType=VARCHAR} </if>
			   <if test="projectType != null" > and project_type = #{projectType,jdbcType=VARCHAR} </if>
			  
		      
		      <if test="projectDepartid != null" > and project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
			  <if test="deptIdList != null">
					AND project_departId IN
					<foreach collection="deptIdList" index="item" item="item" open="("
						separator="," close=")">
						#{item}
					</foreach>
			  </if>
		      <if test="industryOwn != null" > and industry_own = #{industryOwn,jdbcType=BIGINT} </if>
		      <if test="stockTransfer != null" > and stock_transfer = #{stockTransfer,jdbcType=INTEGER} </if>
		      
		      <if test="projectValuations != null" > and project_valuations = #{projectValuations,jdbcType=DECIMAL} </if>
		      <if test="finalValuations != null" > and final_valuations = #{finalValuations,jdbcType=DECIMAL} </if>
		      <if test="financeStatus != null" >
		      	AND EXISTS(
				SELECT 1
				FROM information_title t
				INNER JOIN information_result r ON t.id = r.title_id 
				WHERE r.project_id = sop_project.id AND t.code = 'NO1_1_7' 
				AND r.content_choose = #{financeStatus,jdbcType=VARCHAR} 
				)
		      </if>
		     
		      <if test="projectContribution != null" >  and project_contribution = #{projectContribution,jdbcType=DECIMAL} </if>
		      <if test="finalContribution != null" >  and final_contribution = #{finalContribution,jdbcType=DECIMAL} </if>
		      <if test="currencyUnit != null" > and currency_unit = #{currencyUnit,jdbcType=INTEGER} </if>
		      <if test="projectShareRatio != null" > and project_share_ratio = #{projectShareRatio,jdbcType=DECIMAL} </if>
		      <if test="finalShareRatio != null" > and final_share_ratio = #{finalShareRatio,jdbcType=DECIMAL} </if>
		      <if test="serviceCharge != null" > and service_charge = #{serviceCharge,jdbcType=DECIMAL} </if> 
		      <if test="projectCareerline != null" > and project_careerline = #{projectCareerline,jdbcType=VARCHAR} </if>
		      <if test="projectCompany != null" > and project_company = #{projectCompany,jdbcType=VARCHAR} </if>
		      <if test="formationDate != null" > and formation_date = #{formationDate,jdbcType=BIGINT} </if>
		      <if test="projectCompanyCode != null" > and project_company_code = #{projectCompanyCode,jdbcType=VARCHAR} </if>
		      <if test="companyLegal != null" > and company_legal = #{companyLegal,jdbcType=VARCHAR} </if>
		      
		      <if test="createUposition != null" > and create_uposition = #{createUposition,jdbcType=VARCHAR} </if>
		     
		      <if test="projectStatus != null" > and project_status = #{projectStatus,jdbcType=VARCHAR} </if>
		      <if test="updatedTime != null" > and updated_time = #{updatedTime,jdbcType=BIGINT} </if>
		      <if test="createdTime != null" > and created_time = #{createdTime,jdbcType=BIGINT} </if>
		       <if test="projectTime != null" > and project_time = #{projectTime,jdbcType=BIGINT} </if>
		    
		      
		      <if test="startTime != null"> <![CDATA[  and created_time >= #{startTime,jdbcType=BIGINT} ]]> </if>
			  <if test="endTime != null"> <![CDATA[ and created_time <= #{endTime,jdbcType=BIGINT} ]]> </if>
		      
		      <if test="projectDescribe != null" > and project_describe = #{projectDescribe,jdbcType=LONGVARCHAR} </if>
		      <if test="projectBusinessModel != null" > and project_business_model = #{projectBusinessModel,jdbcType=LONGVARCHAR} </if>
		      <if test="companyLocation != null" > and company_location = #{companyLocation,jdbcType=LONGVARCHAR} </if>
		      <if test="userPortrait != null" > and user_portrait = #{userPortrait,jdbcType=LONGVARCHAR} </if>
		      <if test="prospectAnalysis != null" > and prospect_analysis = #{prospectAnalysis,jdbcType=LONGVARCHAR} </if>
			  <if test="nameCodeLike != null">
			  	and (upper(project_name) like CONCAT("%",upper(#{nameCodeLike}),"%")
				<if test="escapeChar ">
					escape '/'
				</if>
				or upper(project_code) like CONCAT("%",upper(#{nameCodeLike}),"%")
				<if test="escapeChar ">
					escape '/'
				</if>
				)
			  </if>
			  <if test="projectName != null" > and project_name = #{projectName,jdbcType=VARCHAR} </if>
			  <if test="createUname != null" > and create_uname = #{createUname,jdbcType=VARCHAR} </if>
		      <if test="projectCode != null" > and project_code = #{projectCode,jdbcType=VARCHAR} </if>
				<!-- 模糊查询 -->
				<if test="keyword != null">
					<choose>
						<when test="flagkeyword=='concatcode'" >
							and (upper(project_name) like CONCAT("%",upper(#{keyword}),"%")
							<if test="escapeChar ">
								escape '/'
							</if>
							or create_uname like CONCAT("%",#{keyword},"%")
							<if test="escapeChar ">
								escape '/'
							</if>
							)
						</when>
						<when test="flagkeyword==null">
							and (upper(project_name) like CONCAT("%",upper(#{keyword}),"%")
							<if test="escapeChar ">
								escape '/'
							</if>
							or upper(project_code) like CONCAT("%",upper(#{keyword}),"%")
							<if test="escapeChar ">
								escape '/'
							</if>
							)
						</when>
						<when test="flagkeyword=='onlyName'">
							and upper(project_name) like CONCAT("%",upper(#{keyword}),"%")
							<if test="escapeChar ">
								escape '/'
							</if>
						</when>
					</choose>
				</if>
				<!--根据计划额度查询  -->
				<if test="rComplany != null"> 
					<if test="aComplany != null">
					 	and project_contribution <![CDATA[ >=]]> #{aComplany,jdbcType=DECIMAL} 					 							 
					</if> 
					<if test="bComplany != null">
						and project_contribution  &lt; #{bComplany,jdbcType=DECIMAL} 
					</if>								 												
				</if>
				
				<!-- 过滤项目 -->
				<if test="resultCloseFilter != null">
					AND project_status !=  #{resultCloseFilter,jdbcType=VARCHAR}
				</if>
				<if test="ids != null">
					AND id IN
					<foreach collection="ids" index="item" item="item" open="("
	                      separator="," close=")">
	                          #{item}
                    </foreach>
				</if>
				<if test="projectProgressList != null">
					AND project_progress IN
					<foreach collection="projectProgressList" index="item" item="item" open="(" separator="," close=")">
	                          #{item}
                    </foreach>
				</if>
				<if test="fromIdea == true">
					and idea_id is not null
				</if>
				<if test="ideaId != null">
					and idea_id = #{ideaId}
				</if>
				<if test="faFlag != null">
					AND EXISTS(
					SELECT 1 
					FROM information_result rst 
					WHERE rst.title_id = 1120 AND rst.project_id = sop_project.id AND rst.content_choose = #{faFlag}
					)
				</if>
				<if test="faName != null">
					and fa_name = #{faName}
				</if>
				<if test="stopSearch != null">
					and 1 = 2
				</if>
				<if test="greanChannel != null">
					and (grean_channel like CONCAT("%",#{greanChannel},"%")
				</if>
					<if test="financeMode != null">
					and finance_mode  = #{financeMode}
				</if>
				<if test="projectPerson != null">
					 AND EXISTS(
						SELECT 1
						FROM information_listdata 
						WHERE title_id = 1303 
						AND CODE = 'team-members' 
						AND information_listdata.project_id=sop_project.id 
						AND upper(field_1) LIKE CONCAT("%",upper(#{projectPerson}),"%")
						<if test="escapeChar ">
							escape '/'
						</if>
					)
				</if>
				
			</trim>
		</where>
		<if test="sorting != null">order by ${sorting}</if>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
	</sql>
	
	<!-- 查询总数 -->
	<select id="selectCount" resultType="java.lang.Long" parameterType="java.util.Map">
		select count(id)  
		from sop_project
		<include refid="Base_Where_Clause" />
	</select>

	<!-- 查询 -->
	<select id="select" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from sop_project
		<include refid="Base_Where_Clause" />
	</select>


	<!-- 查询 -->
	<select id="selectColumnList" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
			id, 
			project_name, 
			project_code, 
			project_type, 
			project_careerline, 
			project_departId,
			industry_own, 
		    create_uid, 
		    create_uname, 
		    create_uposition, 
		    project_progress, 
		    project_status, 
		    updated_time, 
		    created_time
		from sop_project
		<include refid="Base_Where_Clause" />
	</select>
	
	<!-- 根据ID查询 -->
	<select id="selectById" resultMap="BaseResultMap" parameterType="java.lang.Long">
		select
		<include refid="Base_Column_List" />
		from sop_project
		where id = #{id}
	</select>
	
  	<insert id="insert" useGeneratedKeys="true" keyProperty="id" parameterType="com.galaxyinternet.model.project.Project" >
	    <![CDATA[
	     insert into sop_project (id, project_name, project_code, 
	      project_type, stock_transfer, project_careerline, project_departId, industry_own, 
	      project_valuations, final_valuations, finance_status, project_contribution, final_contribution, 
	      currency_unit, project_share_ratio, final_share_ratio, service_charge,project_company, formation_date, project_company_code, company_legal, create_uid, 
	      create_uname, create_uposition, project_progress, 
	      project_status, updated_time, created_time, 
	      project_describe,project_describe_financing, project_business_model, 
	      company_location, user_portrait, 
	      prospect_analysis,idea_id,fa_flag,fa_name,grean_channel,remark,project_time,finance_mode,progress_history,business_type_code)
	    values (#{id,jdbcType=BIGINT}, #{projectName,jdbcType=VARCHAR}, #{projectCode,jdbcType=VARCHAR},
	      #{projectType,jdbcType=VARCHAR}, #{stockTransfer,jdbcType=INTEGER}, #{projectCareerline,jdbcType=VARCHAR}, #{projectDepartid,jdbcType=BIGINT}, #{industryOwn,jdbcType=BIGINT}, 
	      #{projectValuations,jdbcType=DECIMAL}, #{finalValuations,jdbcType=DECIMAL}, #{financeStatus,jdbcType=VARCHAR}, #{projectContribution,jdbcType=DECIMAL}, #{finalContribution,jdbcType=DECIMAL}, 
	      #{currencyUnit,jdbcType=INTEGER}, #{projectShareRatio,jdbcType=DECIMAL}, #{finalShareRatio,jdbcType=DECIMAL},#{serviceCharge,jdbcType=DECIMAL}, #{projectCompany,jdbcType=VARCHAR}, #{formationDate,jdbcType=BIGINT}, #{projectCompanyCode,jdbcType=VARCHAR}, #{companyLegal,jdbcType=VARCHAR}, #{createUid,jdbcType=BIGINT}, 
	      #{createUname,jdbcType=VARCHAR}, #{createUposition,jdbcType=VARCHAR}, #{projectProgress,jdbcType=VARCHAR}, 
	      #{projectStatus,jdbcType=VARCHAR}, #{updatedTime,jdbcType=BIGINT}, #{createdTime,jdbcType=BIGINT}, 
	      #{projectDescribe,jdbcType=LONGVARCHAR},#{projectDescribeFinancing,jdbcType=LONGVARCHAR}, #{projectBusinessModel,jdbcType=LONGVARCHAR}, 
	      #{companyLocation,jdbcType=LONGVARCHAR}, #{userPortrait,jdbcType=LONGVARCHAR}, 
	      #{prospectAnalysis,jdbcType=LONGVARCHAR},#{ideaId,jdbcType=BIGINT},#{faFlag,jdbcType=VARCHAR},#{faName,jdbcType=VARCHAR},#{greanChannel,jdbcType=VARCHAR},#{remark,jdbcType=LONGVARCHAR},#{projectTime,jdbcType=BIGINT},#{financeMode,jdbcType=VARCHAR},
	      #{progressHistory,jdbcType=VARCHAR},#{businessTypeCode,jdbcType=VARCHAR}
	      )
	    ]]>
    </insert>
    
    <insert id="insertProject" useGeneratedKeys="true" keyProperty="id" parameterType="com.galaxyinternet.model.project.Project" >
	    <![CDATA[
	     insert into sop_project (id, project_name, project_code, 
	      project_type, stock_transfer, project_careerline, project_departId, industry_own,
	      project_valuations, final_valuations, finance_status, project_contribution, final_contribution,
	      currency_unit, project_share_ratio, final_share_ratio,service_charge, project_company, formation_date, project_company_code, company_legal, create_uid, 
	      create_uname, create_uposition, project_progress, 
	      project_status, updated_time, created_time, 
	      project_describe,project_describe_financing, project_business_model, 
	      company_location, user_portrait, 
	      prospect_analysis,idea_id,fa_flag,fa_name,grean_channel,remark,project_time,,finance_mode
	      progress_history,business_type_code)
	    values (#{id,jdbcType=BIGINT}, #{projectName,jdbcType=VARCHAR}, #{projectCode,jdbcType=VARCHAR},
	      #{projectType,jdbcType=VARCHAR}, #{stockTransfer,jdbcType=INTEGER}, #{projectCareerline,jdbcType=VARCHAR}, #{projectDepartid,jdbcType=BIGINT},  #{industryOwn,jdbcType=BIGINT}, 
	      #{projectValuations,jdbcType=DECIMAL}, #{finalValuations,jdbcType=DECIMAL}, #{financeStatus,jdbcType=VARCHAR}, #{projectContribution,jdbcType=DECIMAL}, #{finalContribution,jdbcType=DECIMAL}, 
	      #{currencyUnit,jdbcType=INTEGER}, #{projectShareRatio,jdbcType=DECIMAL}, #{finalShareRatio,jdbcType=DECIMAL},#{serviceCharge,jdbcType=DECIMAL},  #{projectCompany,jdbcType=VARCHAR}, #{formationDate,jdbcType=BIGINT}, #{projectCompanyCode,jdbcType=VARCHAR}, #{companyLegal,jdbcType=VARCHAR}, #{createUid,jdbcType=BIGINT}, 
	      #{createUname,jdbcType=VARCHAR}, #{createUposition,jdbcType=VARCHAR}, #{projectProgress,jdbcType=VARCHAR}, 
	      #{projectStatus,jdbcType=VARCHAR}, #{updatedTime,jdbcType=BIGINT}, #{createdTime,jdbcType=BIGINT}, 
	      #{projectDescribe,jdbcType=LONGVARCHAR},#{projectDescribeFinancing,jdbcType=LONGVARCHAR}, #{projectBusinessModel,jdbcType=LONGVARCHAR}, 
	      #{companyLocation,jdbcType=LONGVARCHAR}, #{userPortrait,jdbcType=LONGVARCHAR}, 
	      #{prospectAnalysis,jdbcType=LONGVARCHAR},#{ideaId,jdbcType=BIGINT},#{faFlag,jdbcType=VARCHAR},#{faName,jdbcType=VARCHAR},#{greanChannel,jdbcType=VARCHAR},#{remark,jdbcType=LONGVARCHAR},#{projectTime,jdbcType=BIGINT},#{financeMode,jdbcType=VARCHAR},
	      #{progressHistory,jdbcType=VARCHAR},#{businessTypeCode,jdbcType=VARCHAR}
	      )
	    ]]>
    </insert>
    
    <!-- 更新 -->
	<update id="updateByIdSelective" parameterType="com.galaxyinternet.model.project.Project">
		update sop_project
		<set>
			  <!-- 
			  <if test="projectName != null" >  project_name = #{projectName,jdbcType=VARCHAR}, </if>
		      <if test="projectCode != null" >  project_code = #{projectCode,jdbcType=VARCHAR}, </if>
		      <if test="projectType != null" >  project_type = #{projectType,jdbcType=VARCHAR}, </if>
		       -->
		      <if test="stockTransfer != null" >  stock_transfer = #{stockTransfer,jdbcType=INTEGER}, </if>
		      <if test="projectCareerline != null" > project_careerline = #{projectCareerline,jdbcType=VARCHAR}, </if>
		      <if test="projectDepartid != null" >  project_departId = #{projectDepartid,jdbcType=BIGINT}, </if>
		      <if test="industryOwn" > industry_own = #{industryOwn,jdbcType=BIGINT}, </if>
		      <if test="projectValuations != null" >   project_valuations = #{projectValuations,jdbcType=DECIMAL}, </if>
		      <if test="finalValuations != null" > final_valuations = #{finalValuations,jdbcType=DECIMAL}, </if>
		      <if test="financeStatus" > finance_status = #{financeStatus,jdbcType=VARCHAR}, </if>
		      <if test="projectContribution != null" >   project_contribution = #{projectContribution,jdbcType=DECIMAL}, </if>
		      <if test="finalContribution != null" >  final_contribution = #{finalContribution,jdbcType=DECIMAL}, </if>
		      <if test="currencyUnit != null" >  currency_unit = #{currencyUnit,jdbcType=INTEGER}, </if>
		      <if test="projectShareRatio != null" > project_share_ratio = #{projectShareRatio,jdbcType=DECIMAL}, </if>
		      <if test="finalShareRatio != null" > final_share_ratio = #{finalShareRatio,jdbcType=DECIMAL}, </if>
		      <if test="serviceCharge != null" > service_charge = #{serviceCharge,jdbcType=DECIMAL}, </if>
		      <if test="projectCompany != null" >  project_company = #{projectCompany,jdbcType=VARCHAR}, </if>
		      <if test="formationDate != null" > formation_date = #{formationDate,jdbcType=BIGINT}, </if>
		      <if test="projectCompanyCode != null" >  project_company_code = #{projectCompanyCode,jdbcType=VARCHAR}, </if>
		      <if test="companyLegal != null" > company_legal = #{companyLegal,jdbcType=VARCHAR}, </if>
		      
		      <if test="createUid != null" >  create_uid = #{createUid,jdbcType=BIGINT}, </if>
		      <if test="createUname != null" >  create_uname = #{createUname,jdbcType=VARCHAR}, </if>
		      <if test="createUposition != null" >  create_uposition = #{createUposition,jdbcType=VARCHAR}, </if>
		      <if test="projectProgress != null" >  project_progress = #{projectProgress,jdbcType=VARCHAR}, </if>
		      <if test="projectStatus != null" >  project_status = #{projectStatus,jdbcType=VARCHAR}, </if>
		      <if test="updatedTime != null" >  updated_time = #{updatedTime,jdbcType=BIGINT}, </if>
		      <if test="createdTime != null" >  created_time = #{createdTime,jdbcType=BIGINT}, </if>
		      <if test="projectDescribe != null" >  project_describe = #{projectDescribe,jdbcType=LONGVARCHAR}, </if>
		       <if test="projectDescribeFinancing != null" >  project_describe_financing = #{projectDescribeFinancing,jdbcType=LONGVARCHAR}, </if>
		      <if test="projectBusinessModel != null" >  project_business_model = #{projectBusinessModel,jdbcType=LONGVARCHAR}, </if>
		      <if test="companyLocation != null" >  company_location = #{companyLocation,jdbcType=LONGVARCHAR}, </if>
		      <if test="userPortrait != null" >  user_portrait = #{userPortrait,jdbcType=LONGVARCHAR}, </if>
		      <if test="prospectAnalysis != null" >  prospect_analysis = #{prospectAnalysis,jdbcType=LONGVARCHAR}, </if>
		      <if test="nextFinancingSource != null" >  next_financing_source = #{nextFinancingSource,jdbcType=LONGVARCHAR}, </if>
		      <if test="industryAnalysis != null" >  industry_analysis = #{industryAnalysis,jdbcType=LONGVARCHAR}, </if>
		      <if test="operationalData != null" >  operational_data = #{operationalData,jdbcType=LONGVARCHAR}, </if>
		      <if test="faFlag != null" >  fa_flag = #{faFlag,jdbcType=VARCHAR}, </if>
		      <if test="faName != null" >  fa_name = #{faName,jdbcType=VARCHAR}, </if>
		      <if test="greanChannel != null" >  grean_channel = #{greanChannel,jdbcType=VARCHAR}, </if>
		      <if test="remark != null" >  remark = #{remark,jdbcType=VARCHAR}, </if>
		      <if test="progressHistory != null" >  progress_history = #{progressHistory,jdbcType=VARCHAR}, </if>
		      <if test="businessTypeCode != null" >  business_type_code = #{businessTypeCode,jdbcType=VARCHAR}, </if>
		      <if test="projectTime != null" > project_time = #{projectTime,jdbcType=BIGINT} ,</if>
		      <if test="financeMode != null" > finance_mode = #{financeMode,jdbcType=VARCHAR}, </if>
		      <if test="isdelete != null" > is_delete = #{isdelete,jdbcType=BIGINT}, </if>
		      <if test="deleteReason != null" > delete_reason = #{deleteReason,jdbcType=VARCHAR} </if>
		</set>
		<where>
			<trim prefixOverrides="and">
			  <if test="id != null"> and id =#{id}</if>
			  <if test="projectName != null" > and project_name = #{projectName,jdbcType=VARCHAR} </if>
		      <if test="projectCode != null" > and project_code = #{projectCode,jdbcType=VARCHAR} </if>
		      <if test="projectType != null" > and project_type = #{projectType,jdbcType=VARCHAR} </if>
		      <if test="projectCareerline != null" > and project_careerline = #{projectCareerline,jdbcType=VARCHAR} </if>
		      <if test="projectDepartid != null" > and project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
		      <if test="industryOwn != null" > and industry_own = #{industryOwn,jdbcType=BIGINT} </if>
		      <if test="projectValuations != null" > and project_valuations = #{projectValuations,jdbcType=DECIMAL} </if>
		      <if test="finalValuations != null" > and final_valuations = #{finalValuations,jdbcType=DECIMAL} </if>
		      <if test="financeStatus != null" > and finance_status = #{financeStatus,jdbcType=VARCHAR} </if>
		      <if test="projectContribution != null" >  and project_contribution = #{projectContribution,jdbcType=DECIMAL} </if>
		      <if test="finalContribution != null" >  and final_contribution = #{finalContribution,jdbcType=DECIMAL} </if>
		      <if test="currencyUnit != null" > and currency_unit = #{currencyUnit,jdbcType=INTEGER} </if>
		      <if test="projectShareRatio != null" > and project_share_ratio = #{projectShareRatio,jdbcType=DECIMAL} </if>
		      <if test="finalShareRatio != null" > and final_share_ratio = #{finalShareRatio,jdbcType=DECIMAL} </if>
		      <if test="serviceCharge != null" > and service_charge = #{serviceCharge,jdbcType=DECIMAL} </if>
		      <if test="projectCompany != null" > and project_company = #{projectCompany,jdbcType=VARCHAR} </if>
		      <if test="formationDate != null" > and formation_date = #{formationDate,jdbcType=BIGINT} </if>
		      <if test="projectCompanyCode != null" > and project_company_code = #{projectCompanyCode,jdbcType=VARCHAR} </if>
		      <if test="companyLegal != null" > and company_legal = #{companyLegal,jdbcType=VARCHAR} </if>
		      
		      <if test="createUid != null" > and create_uid = #{createUid,jdbcType=BIGINT} </if>
		      <if test="createUname != null" > and create_uname = #{createUname,jdbcType=VARCHAR} </if>
		      <if test="createUposition != null" > and create_uposition = #{createUposition,jdbcType=VARCHAR} </if>
		      <if test="projectProgress != null" > and project_progress = #{projectProgress,jdbcType=VARCHAR} </if>
		      <if test="projectStatus != null" > and project_status = #{projectStatus,jdbcType=VARCHAR} </if>
		      <if test="updatedTime != null" > and updated_time = #{updatedTime,jdbcType=BIGINT} </if>
		      <!--
		      <if test="createdTime != null" >  created_time = #{createdTime,jdbcType=BIGINT}, </if>
		      -->
		      <if test="projectDescribe != null" > and project_describe = #{projectDescribe,jdbcType=LONGVARCHAR} </if>
		      <if test="projectDescribeFinancing != null" > and project_describe_financing = #{projectDescribeFinancing,jdbcType=LONGVARCHAR} </if>
		      <if test="projectBusinessModel != null" > and project_business_model = #{projectBusinessModel,jdbcType=LONGVARCHAR} </if>
		      <if test="companyLocation != null" > and company_location = #{companyLocation,jdbcType=LONGVARCHAR} </if>
		      <if test="userPortrait != null" > and user_portrait = #{userPortrait,jdbcType=LONGVARCHAR} </if>
		      <if test="prospectAnalysis != null" > and prospect_analysis = #{prospectAnalysis,jdbcType=LONGVARCHAR} </if>
		      <if test="remark != null" > and remark = #{remark,jdbcType=LONGVARCHAR} </if>	
		      <if test="financeMode != null" > and finance_mode = #{financeMode,jdbcType=VARCHAR} </if>	
		      <if test="isdelete != null" > and is_delete = #{isdelete,jdbcType=LONGVARCHAR} </if>	
		      <if test="deleteReason != null" > and delete_reason = #{deleteReason,jdbcType=VARCHAR} </if>	
		
			</trim>
		</where>
	</update>
    <!-- 通过ID更新 -->
	<update id="updateById" parameterType="com.galaxyinternet.model.project.Project">
		update sop_project
		<set>
			  <if test="projectName != null" >  project_name = #{projectName,jdbcType=VARCHAR}, </if>
			  <!-- 
		      <if test="projectCode != null" >  project_code = #{projectCode,jdbcType=VARCHAR}, </if>
		      <if test="projectType != null" >  project_type = #{projectType,jdbcType=VARCHAR}, </if>
		       -->
		      <if test="stockTransfer != null" >  stock_transfer = #{stockTransfer,jdbcType=INTEGER}, </if>
		      <if test="projectCareerline != null" > project_careerline = #{projectCareerline,jdbcType=VARCHAR}, </if>
		      <if test="projectDepartid != null" >  project_departId = #{projectDepartid,jdbcType=BIGINT}, </if>
		      <if test="industryOwn" > industry_own = #{industryOwn,jdbcType=BIGINT}, </if>
		      <if test="projectValuations != null" >   project_valuations = #{projectValuations,jdbcType=DECIMAL}, </if>
		      <if test="finalValuations != null" > final_valuations = #{finalValuations,jdbcType=DECIMAL}, </if>
		      <if test="financeStatus" > finance_status = #{financeStatus,jdbcType=VARCHAR}, </if>
		      <if test="projectContribution != null" >   project_contribution = #{projectContribution,jdbcType=DECIMAL}, </if>
		      <if test="finalContribution != null" >  final_contribution = #{finalContribution,jdbcType=DECIMAL}, </if>
		      <if test="currencyUnit != null" >  currency_unit = #{currencyUnit,jdbcType=INTEGER}, </if>
		      <if test="projectShareRatio != null" > project_share_ratio = #{projectShareRatio,jdbcType=DECIMAL}, </if>
		      <if test="finalShareRatio != null" > final_share_ratio = #{finalShareRatio,jdbcType=DECIMAL}, </if>
		      <if test="serviceCharge != null" > service_charge = #{serviceCharge,jdbcType=DECIMAL}, </if>
		      <if test="projectCompany != null" >  project_company = #{projectCompany,jdbcType=VARCHAR}, </if>
		      <if test="formationDate != null" > formation_date = #{formationDate,jdbcType=BIGINT}, </if>
		      <if test="projectCompanyCode != null" >  project_company_code = #{projectCompanyCode,jdbcType=VARCHAR}, </if>
		      <if test="companyLegal != null" > company_legal = #{companyLegal,jdbcType=VARCHAR}, </if>
		      <if test="createUid != null" >  create_uid = #{createUid,jdbcType=BIGINT}, </if>
		      <if test="createUname != null" >  create_uname = #{createUname,jdbcType=VARCHAR}, </if>
		      <if test="createUposition != null" >  create_uposition = #{createUposition,jdbcType=VARCHAR}, </if>
		      <if test="projectProgress != null" >  project_progress = #{projectProgress,jdbcType=VARCHAR}, </if>
		      <if test="projectStatus != null" >  project_status = #{projectStatus,jdbcType=VARCHAR}, </if>
		      <if test="updatedTime != null" >  updated_time = #{updatedTime,jdbcType=BIGINT}, </if>
		      <if test="createdTime != null" >  created_time = #{createdTime,jdbcType=BIGINT}, </if>
		      <if test="projectDescribe != null" >  project_describe = #{projectDescribe,jdbcType=LONGVARCHAR}, </if>
		      <if test="projectDescribeFinancing != null" >  project_describe_financing = #{projectDescribeFinancing,jdbcType=LONGVARCHAR}, </if>
		      <if test="projectBusinessModel != null" >  project_business_model = #{projectBusinessModel,jdbcType=LONGVARCHAR}, </if>
		      <if test="companyLocation != null" >  company_location = #{companyLocation,jdbcType=LONGVARCHAR}, </if>
		      <if test="userPortrait != null" >  user_portrait = #{userPortrait,jdbcType=LONGVARCHAR}, </if>
		      <if test="prospectAnalysis != null" >  prospect_analysis = #{prospectAnalysis,jdbcType=LONGVARCHAR}, </if>
		      <if test="nextFinancingSource != null" >  next_financing_source = #{nextFinancingSource,jdbcType=LONGVARCHAR}, </if>
		      <if test="industryAnalysis != null" >  industry_analysis = #{industryAnalysis,jdbcType=LONGVARCHAR}, </if>
		      <if test="operationalData != null" >  operational_data = #{operationalData,jdbcType=LONGVARCHAR} ,</if>
		      <if test="faFlag != null" >  fa_flag = #{faFlag,jdbcType=VARCHAR} ,</if>
		      <if test="faName != null" >  fa_name = #{faName,jdbcType=VARCHAR}, </if>
		      <if test="greanChannel != null" >  grean_channel = #{greanChannel,jdbcType=VARCHAR},</if>
		      <if test="remark != null" >  remark = #{remark,jdbcType=LONGVARCHAR}, </if>
		      <if test="progressHistory != null" >  progress_history = #{progressHistory,jdbcType=VARCHAR}, </if>
		      <if test="businessTypeCode != null" >  business_type_code = #{businessTypeCode,jdbcType=VARCHAR}, </if>
		      <if test="projectTime != null" > project_time = #{projectTime,jdbcType=BIGINT}, </if>
		     <if test="financeMode != null" > finance_mode = #{financeMode,jdbcType=VARCHAR}, </if>	
		      <if test="isdelete != null" > is_delete = #{isdelete,jdbcType=BIGINT}, </if>
		      <if test="deleteReason != null" > delete_reason = #{deleteReason,jdbcType=VARCHAR} </if>
		
		</set>
		where id = #{id}
	</update>
    
    <!-- 删除 -->
	<delete id="delete" parameterType="java.util.Map">
		delete from sop_project
		<include refid="Base_Where_Clause" />
	</delete>
     <!-- 根据ID删除 -->
	<delete id="deleteById" parameterType="java.lang.Long">
		delete from sop_project where id = #{id}
	</delete>
	
	<select id="selectTotalSummary" resultMap="BaseResultMap" parameterType="java.util.Map">
		select count(1) as count,sum(project_valuations) as project_valuations
		from sop_project
		<where>
			  <if test="projectDepartid != null" > project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
			  <if test="createUid != null" > and create_uid = #{createUid,jdbcType=BIGINT} </if>
			  <if test="createDateFrom != null" > and created_time <![CDATA[>=]]> #{createDateFrom,jdbcType=BIGINT} </if>
			  <if test="createDateThrough != null" > and created_time <![CDATA[>=]]> #{createDateThrough,jdbcType=BIGINT} </if>
		</where>
	</select>
	<select id="selectStageSummary" resultMap="BaseResultMap" parameterType="java.util.Map">
		select count(1)as count,project_progress from sop_project
		<where>
			  <if test="projectDepartid != null" > project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
			  <if test="createUid != null" > and create_uid = #{createUid,jdbcType=BIGINT} </if>
		</where>
		group by project_progress
	</select>
	
	<select id="selectListById" resultMap="BaseResultMap" >
		select id,project_code,project_name,project_departId,project_careerline,create_uname,create_uid from sop_project
		    where id in
					<foreach collection="list" index="item" item="item" open="("
						separator="," close=")">
						#{item}
					</foreach>
	</select>
	
	<!-- 查询 项目id-->
	<select id="selectIds" resultType="Long" parameterType="java.util.Map">
		select
		 id 
		from sop_project
		<include refid="Base_Where_Clause" />
	</select>
	
	
	
	
	<!-- 拉取   跳过尽调阶段的 项目id -->
	<select id="selectProIdsForPrivilege" resultType="java.lang.Long" parameterType="java.util.Map">
		SELECT 
			id
		FROM
			sop_project
		<where>
			<trim prefixOverrides="and">
				<if test="progressIntValue != null" > 
					CAST(REPLACE(project_progress,'projectProgress:','') AS SIGNED) > #{progressIntValue} 
				</if>
				
				<if test="notCompleteTaskStatus != null and taskFlags !=null" > 
					AND id IN(
						SELECT 
							project_id
						FROM
							sop_task
						<where>
							<trim prefixOverrides="and">
								<if test="projectId != null"> AND project_id = #{projectId,jdbcType=BIGINT} </if>
								AND task_flag IN
								<foreach collection="taskFlags" index="item" item="item" open="(" separator="," close=")">
									#{item}
								</foreach>
								AND task_status  !=  #{notCompleteTaskStatus,jdbcType=VARCHAR}
							</trim>
						</where>
						GROUP BY project_id
					)
				</if>
				
				<!-- 过滤已关闭项目 -->
				<if test="resultCloseFilter != null"> AND project_status != #{resultCloseFilter,jdbcType=VARCHAR} </if>
			</trim>
		</where>
	</select>
	
	
	
	
	
	
	
	
	<!-- report -->
	
		<!-- 查询 -->
	<select id="selectProjectReportForGg" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
			project_departId, project_type, count(id) completed
		from sop_project
		<include refid="Base_Where_Clause" />
		GROUP BY project_departId,project_type
	</select>
	
	
	<select id="selectUserCompletedProNum" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
			create_uid, project_departId, count(id) completed
		from sop_project
		<include refid="Base_Where_Clause" />
		GROUP BY create_uid
	</select>
	<select id="selectDeptCompletedProNum" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
			project_departId, count(id) completed
		from sop_project
		<include refid="Base_Where_Clause" />
		GROUP BY project_departId
	</select>
	
	
	<select id="selectUserProNumOrderByNum" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
			create_uid, project_departId, count(id) completed
		from sop_project
		<where>
			<trim prefixOverrides="and">
		
				<if test="ids != null">
					AND id IN
					<foreach collection="ids" index="item" item="item" open="(" separator="," close=")">
						#{item}
					</foreach>
				</if>
		
				<if test="createtUids != null">
					AND create_uid IN
					<foreach collection="createtUids" index="item" item="item" open="(" separator="," close=")">
						#{item}
					</foreach>
				</if>
				
				<if test="projectType != null"> and project_type = #{projectType,jdbcType=VARCHAR} </if>
		
				<if test="projectDepartid != null"> and project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
				<if test="deptIdList != null">
					AND project_departId IN
					<foreach collection="deptIdList" index="item" item="item" open="(" separator="," close=")">
						#{item}
					</foreach>
				</if>
		
				<if test="projectCareerline != null"> and project_careerline = #{projectCareerline,jdbcType=VARCHAR} </if>
		
				<if test="projectStatus != null"> and project_status = #{projectStatus,jdbcType=VARCHAR} </if>
		
				<if test="startTime != null"> <![CDATA[  and created_time >= #{startTime,jdbcType=BIGINT} ]]> </if>
				<if test="endTime != null"> <![CDATA[ and created_time <= #{endTime,jdbcType=BIGINT} ]]> </if>
		
				<!-- 过滤已关闭项目 -->
				<if test="resultCloseFilter != null"> AND project_status != #{resultCloseFilter,jdbcType=VARCHAR} </if>
			</trim>
		</where>
		GROUP BY create_uid
		<if test="sorting != null"> order by ${sorting} </if>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
		
	</select>
	
	
	
	
	<select id="selectDeptProNumOrderByNum" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
			project_departId, count(id) completed
		from sop_project
		<where>
			<trim prefixOverrides="and">
		
				<if test="ids != null">
					AND id IN
					<foreach collection="ids" index="item" item="item" open="(" separator="," close=")">
						#{item}
					</foreach>
				</if>
		
				<if test="createtUids != null">
					AND create_uid IN
					<foreach collection="createtUids" index="item" item="item" open="(" separator="," close=")">
						#{item}
					</foreach>
				</if>
				
				<if test="projectType != null"> and project_type = #{projectType,jdbcType=VARCHAR} </if>
		
				<if test="projectDepartid != null"> and project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
				<if test="deptIdList != null">
					AND project_departId IN
					<foreach collection="deptIdList" index="item" item="item" open="(" separator="," close=")">
						#{item}
					</foreach>
				</if>
		
				<if test="projectCareerline != null"> and project_careerline = #{projectCareerline,jdbcType=VARCHAR} </if>
		
				<if test="projectStatus != null"> and project_status = #{projectStatus,jdbcType=VARCHAR} </if>
		
				<if test="startTime != null"> <![CDATA[  and created_time >= #{startTime,jdbcType=BIGINT} ]]> </if>
				<if test="endTime != null"> <![CDATA[ and created_time <= #{endTime,jdbcType=BIGINT} ]]> </if>
		
				<!-- 过滤已关闭项目 -->
				<if test="resultCloseFilter != null"> AND project_status != #{resultCloseFilter,jdbcType=VARCHAR} </if>
			</trim>
		</where>
		GROUP BY project_departId
		<if test="sorting != null"> order by ${sorting} </if>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
		
	</select>
	
	
	
	
	<!-- 查询总数 -->
	<select id="selectUserProNumRowCount" resultType="java.lang.Long" parameterType="java.util.Map">
		select count(a.create_uid) from (
			select
				create_uid, project_departId, count(id) completed
			from sop_project
			<where>
				<trim prefixOverrides="and">
					<if test="ids != null">
						AND id IN
						<foreach collection="ids" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
			
					<if test="createtUids != null">
						AND create_uid IN
						<foreach collection="createtUids" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
					
					<if test="projectType != null"> and project_type = #{projectType,jdbcType=VARCHAR} </if>
			
					<if test="projectDepartid != null"> and project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
					<if test="deptIdList != null">
						AND project_departId IN
						<foreach collection="deptIdList" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
			
					<if test="projectCareerline != null"> and project_careerline = #{projectCareerline,jdbcType=VARCHAR} </if>
			
					<if test="projectStatus != null"> and project_status = #{projectStatus,jdbcType=VARCHAR} </if>
			
					<if test="startTime != null"> <![CDATA[  and created_time >= #{startTime,jdbcType=BIGINT} ]]> </if>
					<if test="endTime != null"> <![CDATA[ and created_time <= #{endTime,jdbcType=BIGINT} ]]> </if>
			
					<!-- 过滤已关闭项目 -->
					<if test="resultCloseFilter != null"> AND project_status != #{resultCloseFilter,jdbcType=VARCHAR} </if>
				</trim>
			</where>
			GROUP BY create_uid
		) a
	</select>
	
	
	<!-- 查询总数 -->
	<select id="selectDeptProNumRowCount" resultType="java.lang.Long" parameterType="java.util.Map">
		select count(a.project_departId) from (
			select
			project_departId, count(id) completed
			from sop_project
			<where>
				<trim prefixOverrides="and">
					
					<if test="ids != null">
						AND id IN
						<foreach collection="ids" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
			
					<if test="createtUids != null">
						AND create_uid IN
						<foreach collection="createtUids" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
					
					<if test="projectType != null"> and project_type = #{projectType,jdbcType=VARCHAR} </if>
			
					<if test="projectDepartid != null"> and project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
					<if test="deptIdList != null">
						AND project_departId IN
						<foreach collection="deptIdList" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
			
					<if test="projectCareerline != null"> and project_careerline = #{projectCareerline,jdbcType=VARCHAR} </if>
			
					<if test="projectStatus != null"> and project_status = #{projectStatus,jdbcType=VARCHAR} </if>
			
					<if test="startTime != null"> <![CDATA[  and created_time >= #{startTime,jdbcType=BIGINT} ]]> </if>
					<if test="endTime != null"> <![CDATA[ and created_time <= #{endTime,jdbcType=BIGINT} ]]> </if>
			
					<!-- 过滤已关闭项目 -->
					<if test="resultCloseFilter != null"> AND project_status != #{resultCloseFilter,jdbcType=VARCHAR} </if>
				</trim>
			</where>
			GROUP BY project_departId
		) a
	</select>
	
	
	
	
	
	<!-- 查询条件下   各部门   完成项目数、内部项目完成数、 外部项目完成数（all - type1） -->
	<select id="selectDeptAllProNumAndByType" resultMap="BaseResultMap" parameterType="java.util.Map">
		SELECT
			a.project_departId,a.completed completed,IFNULL(b.completed,0) type_completed
		FROM 
			(
			SELECT
				project_departId, COUNT(id) completed
			FROM sop_project
			<where>
				<trim prefixOverrides="and">
			
					<if test="createtUids != null">
						AND create_uid IN
						<foreach collection="createtUids" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
					
					<if test="projectDepartid != null"> and project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
					<if test="deptIdList != null">
						AND project_departId IN
						<foreach collection="deptIdList" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
			
					<if test="projectCareerline != null"> and project_careerline = #{projectCareerline,jdbcType=VARCHAR} </if>
			
					<if test="projectStatus != null"> and project_status = #{projectStatus,jdbcType=VARCHAR} </if>
			
					<if test="startTime != null"> <![CDATA[  and created_time >= #{startTime,jdbcType=BIGINT} ]]> </if>
					<if test="endTime != null"> <![CDATA[ and created_time <= #{endTime,jdbcType=BIGINT} ]]> </if>
			
					<!-- 过滤已关闭项目 -->
					<if test="resultCloseFilter != null"> AND project_status != #{resultCloseFilter,jdbcType=VARCHAR} </if>
				</trim>
			</where>
			GROUP BY project_departId
			) a
			left join
			(
			SELECT
				project_departId, COUNT(id) completed
			FROM sop_project
			<where>
				<trim prefixOverrides="and">
			
					<if test="createtUids != null">
						AND create_uid IN
						<foreach collection="createtUids" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
					
					<if test="projectType != null"> and project_type = #{projectType,jdbcType=VARCHAR} </if>
			
					<if test="projectDepartid != null"> and project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
					<if test="deptIdList != null">
						AND project_departId IN
						<foreach collection="deptIdList" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
			
					<if test="projectCareerline != null"> and project_careerline = #{projectCareerline,jdbcType=VARCHAR} </if>
			
					<if test="projectStatus != null"> and project_status = #{projectStatus,jdbcType=VARCHAR} </if>
			
					<if test="startTime != null"> <![CDATA[  and created_time >= #{startTime,jdbcType=BIGINT} ]]> </if>
					<if test="endTime != null"> <![CDATA[ and created_time <= #{endTime,jdbcType=BIGINT} ]]> </if>
			
					<!-- 过滤已关闭项目 -->
					<if test="resultCloseFilter != null"> AND project_status != #{resultCloseFilter,jdbcType=VARCHAR} </if>
				</trim>
			</where>
			GROUP BY project_departId
			) b
			on 
				a.project_departId = b.project_departId 
		<where>
			<trim prefixOverrides="and">
			  <if test="resultNullFilter != null"> and b.completed != #{resultNullFilter}</if>
			</trim>
		</where>
		<if test="sorting != null"> order by ${sorting} </if>
		<!-- <if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if> -->
	</select>
	
	
	
	
	<!-- 查询条件下   各投资经理    完成项目数、内部项目完成数、 外部项目完成数（all - type1） -->
	<select id="selectTzjlAllProNumAndByType" resultMap="BaseResultMap" parameterType="java.util.Map">
		SELECT
			a.create_uid,a.completed completed,IFNULL(b.completed,0) type_completed
		FROM 
			(
			SELECT
				create_uid, COUNT(id) completed
			FROM sop_project
			<where>
				<trim prefixOverrides="and">
			
					<if test="createtUids != null">
						AND create_uid IN
						<foreach collection="createtUids" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
					
			
					<if test="projectDepartid != null"> and project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
					<if test="deptIdList != null">
						AND project_departId IN
						<foreach collection="deptIdList" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
			
					<if test="projectCareerline != null"> and project_careerline = #{projectCareerline,jdbcType=VARCHAR} </if>
			
					<if test="projectStatus != null"> and project_status = #{projectStatus,jdbcType=VARCHAR} </if>
			
					<if test="startTime != null"> <![CDATA[  and created_time >= #{startTime,jdbcType=BIGINT} ]]> </if>
					<if test="endTime != null"> <![CDATA[ and created_time <= #{endTime,jdbcType=BIGINT} ]]> </if>
			
					<!-- 过滤已关闭项目 -->
					<if test="resultCloseFilter != null"> AND project_status != #{resultCloseFilter,jdbcType=VARCHAR} </if>
				</trim>
			</where>
			GROUP BY create_uid
			) a
			left join
			(
			SELECT
				create_uid, COUNT(id) completed
			FROM sop_project
			<where>
				<trim prefixOverrides="and">
			
					<if test="createtUids != null">
						AND create_uid IN
						<foreach collection="createtUids" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
					
					<if test="projectType != null"> and project_type = #{projectType,jdbcType=VARCHAR} </if>
			
					<if test="projectDepartid != null"> and project_departId = #{projectDepartid,jdbcType=BIGINT} </if>
					<if test="deptIdList != null">
						AND project_departId IN
						<foreach collection="deptIdList" index="item" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</if>
			
					<if test="projectCareerline != null"> and project_careerline = #{projectCareerline,jdbcType=VARCHAR} </if>
			
					<if test="projectStatus != null"> and project_status = #{projectStatus,jdbcType=VARCHAR} </if>
			
					<if test="startTime != null"> <![CDATA[  and created_time >= #{startTime,jdbcType=BIGINT} ]]> </if>
					<if test="endTime != null"> <![CDATA[ and created_time <= #{endTime,jdbcType=BIGINT} ]]> </if>
			
					<!-- 过滤已关闭项目 -->
					<if test="resultCloseFilter != null"> AND project_status != #{resultCloseFilter,jdbcType=VARCHAR} </if>
				</trim>
			</where>
			GROUP BY create_uid
			) b
			on
				a.create_uid = b.create_uid 
		<where>
			<trim prefixOverrides="and">
			  <if test="resultNullFilter != null"> and b.completed != #{resultNullFilter}</if>
			</trim>
		</where>
		<if test="sorting != null"> order by ${sorting} </if>
		<!-- <if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if> -->
	</select>
	
	
	
	
	<select id="selectHasMeetProList" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
			pro.id, 
			pro.project_name, 
			pro.project_code, 
			pro.project_type, 
			pro.project_careerline, 
			pro.project_departId,
			pro.industry_own, 
	    	pro.create_uid, 
	    	pro.create_uname, 
	    	pro.project_progress, 
	    	pro.project_status, 
	    	pro.updated_time, 
	    	pro.created_time,
	    	pro.user_portrait
		from sop_meeting_record meet,sop_project pro
		where
			meet.project_id = pro.id
			
			<if test="startTime != null"> <![CDATA[  and meet.meeting_date >= #{startTime,jdbcType=TIMESTAMP} ]]> </if>
			<if test="endTime != null"> <![CDATA[ and meet.meeting_date <= #{endTime,jdbcType=TIMESTAMP} ]]> </if>
		
			<if test="meetingType != null">and meet.meeting_type = #{meetingType,jdbcType=VARCHAR} </if>
		
			<if test="meetingResult != null">and meet.meeting_result = #{meetingResult,jdbcType=VARCHAR} </if>
		
			<if test="recordType != null"> and meet.record_type = #{recordType,jdbcType=TINYINT} </if>
			
			<if test="projectType != null"> and pro.project_type = #{projectType,jdbcType=VARCHAR} </if>
			
			<if test="createUid != null" >and pro.create_uid = #{createUid,jdbcType=BIGINT} </if>
			<if test="userIdList != null">
				AND pro.create_uid IN
				<foreach collection="userIdList" index="item" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
			
			<if test="departId != null"> and pro.project_departId = #{departId,jdbcType=BIGINT} </if>
			<if test="deptIdList != null">
				AND pro.project_departId IN
				<foreach collection="deptIdList" index="item" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
			<!-- 过滤已关闭项目 -->
			<if test="resultCloseFilter != null"> AND pro.project_status != #{resultCloseFilter,jdbcType=VARCHAR} </if>
		GROUP BY pro.id
		<if test="sorting != null"> order by ${sorting} </if>
		<!-- <if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if> -->
	</select>
	
	<select id="selectProjectTotalTime" resultMap="BaseResultMap" parameterType="java.util.Map">
			
		SELECT s.`id`,s.`project_name`,s.project_company,s.`project_type`,s.`project_careerline`,s.`project_departId`,
		 s.`finance_status`,p.ctime,p.grant_money ,k.health_state,s.`project_describe_financing`,s.`project_describe`,s.`final_share_ratio`,s.`final_contribution`,s.`service_charge` FROM sop_project s 
		INNER JOIN (
		 SELECT a.id,a.`part_grant_id`,a.`grant_money`,
		a.actual_time AS ctime,c.`project_id`
		 FROM sop_grant_actual a 
		 LEFT JOIN sop_grant_part b ON a.`part_grant_id`=b.`id`
		 LEFT JOIN `sop_grant_total` c ON b.`total_grant_id`=c.`id`
		 <if test="sDate != null"> <![CDATA[  and a.actual_time>= #{sDate,jdbcType=TIMESTAMP} ]]> </if>
		 <if test="eDate != null"> <![CDATA[  and a.actual_time<= #{eDate,jdbcType=TIMESTAMP} ]]> </if>
		 GROUP BY c.`project_id` 
		 ORDER BY a.created_time ASC ) p ON  s.id=p.project_id 
		 LEFT JOIN (
		 SELECT FROM_UNIXTIME(v.created_time/1000,'%Y-%m-%d %H:%i:%s') ,v.project_id,v.health_state
		 FROM ( SELECT * FROM sop_project_health q ORDER BY q.`created_time` DESC) v  GROUP BY v.`project_id` ) k
		 ON p.project_id=k.project_id 
		 <where>
			<trim prefixOverrides="and">
			  <if test="projectDepartid != null"> s.project_departId = #{projectDepartid}</if>
			</trim>
		</where>
		<if test="sorting != null"> order by ${sorting} </if>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
		</select>
		<select id="projectTotalTimeCount" resultType="java.lang.Long" parameterType="java.util.Map">
			
		SELECT count(*) FROM sop_project s 
		INNER JOIN (
		 SELECT a.id,a.`part_grant_id`,a.`grant_money`,
		 a.actual_time AS ctime,c.`project_id`
		 FROM sop_grant_actual a 
		 LEFT JOIN sop_grant_part b ON a.`part_grant_id`=b.`id`
		 LEFT JOIN `sop_grant_total` c ON b.`total_grant_id`=c.`id`
		 <if test="sDate!= null"> <![CDATA[ and a.actual_time >= #{sDate,jdbcType=TIMESTAMP} ]]> </if>
		 <if test="eDate!= null"> <![CDATA[ and a.actual_time <= #{eDate,jdbcType=TIMESTAMP} ]]> </if>
		 GROUP BY c.`project_id` 
		 ORDER BY a.created_time ASC ) p ON  s.id=p.project_id 
		 LEFT JOIN (
		 SELECT FROM_UNIXTIME(v.created_time/1000,'%Y-%m-%d %H:%i:%s') ,v.project_id,v.health_state
		 FROM ( SELECT * FROM sop_project_health q ORDER BY q.`created_time` DESC) v  GROUP BY v.`project_id` ) k
		 ON p.project_id=k.project_id 
		 <where>
			<trim prefixOverrides="and">
			  <if test="projectDepartid != null"> s.project_departId = #{projectDepartid}</if>
			</trim>
		</where>
		<if test="sorting != null"> order by ${sorting} </if>
		</select>
		
	<select id="selectDeptProject" resultMap="BaseResultMap" parameterType="java.util.Map">
			
 
 SELECT m.* FROM (
 SELECT s.id,s.`project_name`,s.project_company,s.`project_type`,s.`project_careerline`,s.`project_departId`,
		 s.`finance_status`,MIN(p.ctime) AS ctime,p.grant_money ,k.health_state,s.`project_describe_financing`,s.`project_describe`,s.`final_share_ratio`,s.`final_contribution`,s.`service_charge` FROM sop_project s 
	         INNER JOIN (
	            SELECT  DISTINCT a.`grant_name`,q.`grant_money`,q.ctime ,a.`project_id`,a.`id`,q.xtime
                              FROM sop_grant_total a 
	                           LEFT JOIN (
			           SELECT l.ctime,l.total_grant_id,l.grant_money,l.xtime FROM (  
			             SELECT DISTINCT f.`actual_time` AS ctime,FROM_UNIXTIME(f.created_time/1000,'%Y-%m-%d') xtime,r.`project_id`,e.`grant_money`,e.`total_grant_id`
			             FROM sop_grant_actual f 
			             LEFT JOIN sop_grant_part e ON f.`part_grant_id`=e.id
			             LEFT JOIN sop_grant_total r ON r.`id`=e.`total_grant_id`
			             ORDER BY r.`project_id`,f.`created_time` ASC 
			               ) l GROUP BY l.project_id
			     ) q ON a.`id`=q.total_grant_id
			          	
                   ) p ON  p.project_id=s.`id` 
                 LEFT JOIN (
		 SELECT FROM_UNIXTIME(v.created_time/1000,'%Y-%m-%d %H:%i:%s') ,v.project_id,v.health_state
		 FROM ( SELECT * FROM sop_project_health q ORDER BY q.`created_time` DESC) v  GROUP BY v.`project_id` ) k
		 ON p.project_id=k.project_id  
		 GROUP BY p.project_id ORDER BY p.ctime ASC
        ) m
		 <where>
			<!-- <trim prefixOverrides="and"> -->
			  <if test="projectDepartid != null"> m.project_departId = #{projectDepartid}</if>
			<!-- </trim> -->
		 </where>
		<if test="sorting != null"> order by ${sorting} </if>
		<if test="sorting == ' m.ctime ASC'.toString()"> ,m.project_departId DESC </if>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
		</select>
		<!-- %Y-%m-%d %H:%i:%s -->
      <select id="deptProjectCount" resultType="java.lang.Long" parameterType="java.util.Map">
			
     
 SELECT count(*) FROM (
 SELECT s.id,s.`project_name`,s.project_company,s.`project_type`,s.`project_careerline`,s.`project_departId`,
		 s.`finance_status`,MIN(p.ctime) AS time,p.grant_money ,s.`project_describe_financing`,s.`project_describe`,s.`final_contribution`,s.`final_share_ratio`,s.`service_charge` FROM sop_project s 
	         INNER JOIN (
	           SELECT  DISTINCT a.`grant_name`,q.`grant_money`,q.ctime ,a.`project_id`,a.`id`,q.xtime
                              FROM sop_grant_total a 
	                           LEFT JOIN (
			           SELECT l.ctime,l.total_grant_id,l.grant_money,l.xtime FROM (  
			             SELECT DISTINCT f.`actual_time` AS ctime,FROM_UNIXTIME(f.created_time/1000,'%Y-%m-%d') xtime,r.`project_id`,e.`grant_money`,e.`total_grant_id`
			             FROM sop_grant_actual f 
			             LEFT JOIN sop_grant_part e ON f.`part_grant_id`=e.id
			             LEFT JOIN sop_grant_total r ON r.`id`=e.`total_grant_id`
			             ORDER BY r.`project_id`,f.`created_time` ASC 
			               ) l GROUP BY l.project_id
			     ) q ON a.`id`=q.total_grant_id
			          	
                   ) p ON  p.project_id=s.`id` 
                 LEFT JOIN (
		 SELECT FROM_UNIXTIME(v.created_time/1000,'%Y-%m-%d %H:%i:%s') ,v.project_id,v.health_state
		 FROM ( SELECT * FROM sop_project_health q ORDER BY q.`created_time` DESC) v  GROUP BY v.`project_id` ) k
		 ON p.project_id=k.project_id  
		 GROUP BY p.project_id ORDER BY p.ctime ASC
        ) m
		 <where>
			<!-- <trim prefixOverrides="and"> -->
			  <if test="projectDepartid != null"> m.project_departId = #{projectDepartid}</if>
			<!-- </trim> -->
		 </where>
		</select>
	<select id="selectProjectForPushMessage" resultMap="BaseResultMap" >
		
		SELECT 
		  s.`id`,
		  s.`project_name`,
		  s.`create_uid`,
		  s.project_company,
		  s.`project_type`,
		  s.`project_careerline`,
		  s.`project_departId`,
		  s.`finance_status`,
		  s.`project_describe_financing`,
		  s.`project_describe`,
		  s.`final_share_ratio`,
		  s.`final_contribution`,
		  s.`service_charge` 
   FROM
  sop_project s 
  INNER JOIN 
    (SELECT a.id,a.`part_grant_id`, a.`grant_money`,a.actual_time AS ctime,
      c.`project_id` FROM  sop_grant_actual a LEFT JOIN sop_grant_part b 
      ON a.`part_grant_id` = b.`id`  LEFT JOIN `sop_grant_total` c 
     ON b.`total_grant_id` = c.`id` GROUP BY c.`project_id` 
      ORDER BY a.created_time ASC) p ON s.id = p.project_id 
 
    </select>
</mapper>